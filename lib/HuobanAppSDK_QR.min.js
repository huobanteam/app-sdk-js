!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("HuobanAppSDK",[],e):"object"==typeof exports?exports.HuobanAppSDK=e():t.HuobanAppSDK=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){return p.client||(a.isPC||a.isWap?p.client=new s["default"]:a.isClientIOS||a.isIPhone?p.client=new l["default"]:a.isClientAndroid&&a.isAndroid?p.client=new h["default"]:p.client=new s["default"]),t&&p.client.on(t),p.client}function i(t){return p.host||(p.host=new v["default"],p.host.init()),t&&p.host.on(t),p.host}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1);Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return a[t]}})}),e.client=o,e.host=i,n(2);var u=n(6),s=r(u),c=n(14),l=r(c),f=n(15),h=r(f),d=n(16),v=r(d),p={}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=navigator.userAgent,r=e.isAndroid=!!n.match(/(Android);?[\s\/]+([\d.]+)?/),o=e.isIPad=!!n.match(/(iPad).*OS\s([\d_]+)/),i=e.isIPhone=!o&&!!n.match(/(iPhone\sOS)\s([\d_]+)/),a=e.isMobile=r||i||o,u=e.isInFrame=window.parent!==window,s=e.isWap=a&&u,c=(e.isPC=!a&&!s&&u,document.cookie.match(/huoban_client=(\w+)/));e.isClient=!!c,e.isClientIOS=c&&"ios"==c[1],e.isClientAndroid=c&&"android"==c[1],e.HB_HOST="*",e.MSG_TYPES={CONNECT:"$connect$",DISCONNECT:"$disconnect$",CLOSE:"$close$",PING:"$ping$",BROADCAST:"broadcast"}},function(t,e,n){"use strict";n(3).polyfill(),"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");t=Object(t);for(var e=1;e<arguments.length;e++){var n=arguments[e];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t})},function(t,e,n){(function(e,r){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(e,n){t.exports=n()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function o(t){return"function"==typeof t}function i(t){J=t}function a(t){Q=t}function u(){return function(){return e.nextTick(h)}}function s(){return"undefined"!=typeof K?function(){K(h)}:f()}function c(){var t=0,e=new Z(h),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function l(){var t=new MessageChannel;return t.port1.onmessage=h,function(){return t.port2.postMessage(0)}}function f(){var t=setTimeout;return function(){return t(h,1)}}function h(){for(var t=0;t<W;t+=2){var e=nt[t],n=nt[t+1];e(n),nt[t]=void 0,nt[t+1]=void 0}W=0}function d(){try{var t=n(5);return K=t.runOnLoop||t.runOnContext,s()}catch(e){return f()}}function v(t,e){var n=arguments,r=this,o=new this.constructor(y);void 0===o[ot]&&N(o);var i=r._state;return i?!function(){var t=n[i-1];Q(function(){return j(i,o,t,r._result)})}():S(r,o,t,e),o}function p(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(y);return x(n,t),n}function y(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function b(t){try{return t.then}catch(e){return st.error=e,st}}function m(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function w(t,e,n){Q(function(t){var r=!1,o=m(n,e,function(n){r||(r=!0,e!==n?x(t,n):E(t,n))},function(e){r||(r=!0,T(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,T(t,o))},t)}function k(t,e){e._state===at?E(t,e._result):e._state===ut?T(t,e._result):S(e,void 0,function(e){return x(t,e)},function(e){return T(t,e)})}function P(t,e,n){e.constructor===t.constructor&&n===v&&e.constructor.resolve===p?k(t,e):n===st?T(t,st.error):void 0===n?E(t,e):o(n)?w(t,e,n):E(t,e)}function x(e,n){e===n?T(e,g()):t(n)?P(e,n,b(n)):E(e,n)}function O(t){t._onerror&&t._onerror(t._result),A(t)}function E(t,e){t._state===it&&(t._result=e,t._state=at,0!==t._subscribers.length&&Q(A,t))}function T(t,e){t._state===it&&(t._state=ut,t._result=e,Q(O,t))}function S(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+at]=n,o[i+ut]=r,0===i&&t._state&&Q(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,a=0;a<e.length;a+=3)r=e[a],o=e[a+n],r?j(n,r,o,i):o(i);t._subscribers.length=0}}function C(){this.error=null}function M(t,e){try{return t(e)}catch(n){return ct.error=n,ct}}function j(t,e,n,r){var i=o(n),a=void 0,u=void 0,s=void 0,c=void 0;if(i){if(a=M(n,r),a===ct?(c=!0,u=a.error,a=null):s=!0,e===a)return void T(e,_())}else a=r,s=!0;e._state!==it||(i&&s?x(e,a):c?T(e,u):t===at?E(e,a):t===ut&&T(e,a))}function B(t,e){try{e(function(e){x(t,e)},function(e){T(t,e)})}catch(n){T(t,n)}}function D(){return lt++}function N(t){t[ot]=lt++,t._state=void 0,t._result=void 0,t._subscribers=[]}function I(t,e){this._instanceConstructor=t,this.promise=new t(y),this.promise[ot]||N(this.promise),V(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&E(this.promise,this._result))):T(this.promise,L())}function L(){return new Error("Array Methods must be provided an Array")}function R(t){return new I(this,t).promise}function H(t){var e=this;return new e(V(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function q(t){var e=this,n=new e(y);return T(n,t),n}function Y(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(t){this[ot]=D(),this._result=this._state=void 0,this._subscribers=[],y!==t&&("function"!=typeof t&&Y(),this instanceof G?B(this,t):U())}function z(){var t=void 0;if("undefined"!=typeof r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;if(n){var o=null;try{o=Object.prototype.toString.call(n.resolve())}catch(e){}if("[object Promise]"===o&&!n.cast)return}t.Promise=G}var F=void 0;F=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var V=F,W=0,K=void 0,J=void 0,Q=function(t,e){nt[W]=t,nt[W+1]=e,W+=2,2===W&&(J?J(h):rt())},X="undefined"!=typeof window?window:void 0,$=X||{},Z=$.MutationObserver||$.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof e&&"[object process]"==={}.toString.call(e),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,nt=new Array(1e3),rt=void 0;rt=tt?u():Z?c():et?l():void 0===X?d():f();var ot=Math.random().toString(36).substring(16),it=void 0,at=1,ut=2,st=new C,ct=new C,lt=0;return I.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===it&&n<t;n++)this._eachEntry(e[n],n)},I.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===p){var o=b(t);if(o===v&&t._state!==it)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===G){var i=new n(y);P(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},I.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===it&&(this._remaining--,t===ut?T(r,n):this._result[e]=n),0===this._remaining&&E(r,this._result)},I.prototype._willSettleAt=function(t,e){var n=this;S(t,void 0,function(t){return n._settledAt(at,e,t)},function(t){return n._settledAt(ut,e,t)})},G.all=R,G.race=H,G.resolve=p,G.reject=q,G._setScheduler=i,G._setAsap=a,G._asap=Q,G.prototype={constructor:G,then:v,"catch":function(t){return this.then(null,t)}},G.polyfill=z,G.Promise=G,G})}).call(e,n(4),function(){return this}())},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function i(t){if(f===clearTimeout)return clearTimeout(t);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function a(){p&&d&&(p=!1,d.length?v=d.concat(v):y=-1,v.length&&u())}function u(){if(!p){var t=o(a);p=!0;for(var e=v.length;e;){for(d=v,v=[];++y<e;)d&&d[y].run();y=-1,e=v.length}d=null,p=!1,i(t)}}function s(t,e){this.fun=t,this.array=e}function c(){}var l,f,h=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(t){f=r}}();var d,v=[],p=!1,y=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];v.push(new s(t,e)),1!==v.length||p||o(u)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function g(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:g(o,e,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(7),f=r(l),h=n(8),d=n(1),v=n(9),p=r(v),y=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"init",value:function(t){var e=(0,f["default"])();if(window.parent===window)return(0,h.delay)(function(){e.reject({message:"无法找到宿主环境"})}),e.promise;if(!window.MessageChannel)return(0,h.delay)(function(){e.reject({message:"您的浏览器不支持 MessageChannel"})}),e.promise;if(this._ticket&&this._user)return e.resolve({ticket:this._ticket,user:this._user,app:this._table,table:this._table,version:this._version}),e.promise;this._id=this._unique_id("c_",8);var n=new MessageChannel;return this.port=n.port1,this.port.onmessage=this.handleMessage.bind(this),window.parent.postMessage(d.MSG_TYPES.CONNECT+":"+t+":"+this._id,d.HB_HOST,[n.port2]),this._init(t)}},{key:"_send",value:function(t,e,n){var r={action:t};e&&(r.data=e),n&&(r.id=n),this.port.postMessage(r)}},{key:"_processMessage",value:function(t){var e=t.data;switch(e.action){case d.MSG_TYPES.CONNECT:return e.data.error?(this.emit("error",u({},e.data.error,{type:"connect"})),this.emit("error.connect",e.data.error)):this.connect.resolve(e.data.result),!1;case d.MSG_TYPES.CLOSE:return this.destroy(),!1;case d.MSG_TYPES.PING:return this.push(d.MSG_TYPES.PING),!1}}},{key:"handleWindowBeforeUnload",value:function(t){this._disconnect()}},{key:"_disconnect",value:function(){this.push(d.MSG_TYPES.DISCONNECT)}},{key:"destroy",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.port&&(this._disconnect(),this.port.close(),this.port=null)}}]),e}(p["default"]);e["default"]=y,t.exports=e["default"]},function(t,e,n){function r(){var t,e,n=new Promise(function(n,r){t=n,e=r});return{promise:n,resolve:t,reject:e}}var o;o=function(){return r}.call(e,n,e,t),!(void 0!==o&&(t.exports=o))},function(t,e){"use strict";function n(t){var e={key:t.field||t.key};return t.query||(t.query={}),"created_by"==t.key?e.values=t.query["in"]:"create_on"==t.key?e.values=o({},t.query):(a(t.query["in"])?c(t.query["in"][0])&&"myself"!=t.query["in"][0]?e.keywords=t.query["in"]:e.values=t.query["in"]:e.values=o({},t.query),s(t.query.em)&&(e.is_set=!t.query.em),t.query.in_field&&(e.fields=t.query.in_field),a(t.query.inc)&&(e.values=t.query.inc)),e}function r(t){var e={field:t.key,query:{}};return"created_by"==t.key?e.query["in"]=t.values:"create_on"==t.key?e.query=o({},t.values):(u(t.values)?e.query=o({},t.values):a(t.values)&&(e.query["in"]=t.values),t.keywords&&a(t.keywords)&&t.keywords.length&&(e.query["in"]=t.keywords),t.is_set!==!0&&t.is_set!==!1||(e.query.em=!t.is_set),t.fields&&(e.query.in_field=t.fields),a(t.within)&&(e.query.inc=t.within)),e}Object.defineProperty(e,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=Object.prototype.toString,a=(e.delay=function(t,e){return setTimeout(t,e||0)},e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===i.call(t)}),u=e.isObject=function(t){return"[object Object]"===i.call(t)},s=e.isBool=function(t){return"[object Boolean]"===i.call(t)},c=e.isString=function(t){return"[object String]"===i.call(t)};e.cvFiltersToV1=function l(t){var e=Object.keys(t),r={};return e.forEach(function(e){u(t[e])?r[e]=l(t[e]):a(t[e])&&(r[e]=t[e].map(n))}),r},e.cvFiltersToV2=function f(t){var e=Object.keys(t),n={};return e.forEach(function(e){u(t[e])?n[e]=f(t[e]):a(t[e])&&(n[e]=t[e].map(r))}),n}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(10),f=r(l),h=n(7),d=r(h),v=n(11),p=r(v),y=n(1),g=n(8),_=n(12),b=r(_),m={render:"image",crisp:!0,minVersion:1,ecLevel:"L",size:300,ratio:null,fill:"#333",back:"#fff",rounded:50,quiet:1,mode:"plain",mSize:30,mPosX:50,mPosY:50,label:"",fontname:"sans",fontcolor:"#333",image:null,title:null,text:""},w=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._ticket=null,n._user=null,n._table=null,n._version=null,n}return a(e,t),c(e,[{key:"init",value:function(t){return(0,d["default"])().promise}},{key:"openWebPage",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this.push("openWebPage",s({},n,{url:t,title:e}))}},{key:"closeWebPage",value:function(){this.push("closeWebPage")}},{key:"setTitle",value:function(t){this.push("setTitle",{title:t})}},{key:"setNavigationBarVisibility",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.push("setNavigationBarVisibility",{is_visible:t})}},{key:"setBottomToolBarVisibility",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.push("setBottomToolBarVisibility",{is_visible:t})}},{key:"broadcast",value:function(t,e){this.push(y.MSG_TYPES.BROADCAST,e?{action:t,data:e}:{action:t})}},{key:"openUserProfile",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],r={placement:"bottom"};e=s({},r,e,{user_id:t}),n&&y.isPC&&(e.ePos=this._getEventPosition(n)),this.push("openUserProfile",e)}},{key:"getTableData",value:function(t){return this.send("getTableData",{table_id:t})}},{key:"getSpaceMembers",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.send("getSpaceMembers",t)}},{key:"openFilter",value:function(){var t=void 0,e=void 0,n=void 0;1==arguments.length?(t=this.table,n=arguments.length<=0?void 0:arguments[0]):2==arguments.length?(t=this.table,e=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1]):3==arguments.length&&(t=t&&t.table_id?t:this.table);var r={table_id:t.table_id,space_id:t.space_id},o=this._checkUp2V2();e&&["object","function"].indexOf("undefined"==typeof e?"undefined":u(e))>=0&&0!==e.length&&(r.filters=o?e:(0,g.cvFiltersToV1)(e));var i=void 0;return i=n&&!o?function(t){t.filters&&(t.filters=(0,g.cvFiltersToV2)(t.filters)),n(t)}:n,this.send("openFilter",r,null,i)}},{key:"openItemDiff",value:function(t,e,n,r){var o=void 0;o=n||r||!e?s({},r,{item_id:parseInt(t,10),from_revision_id:parseInt(e,10),to_revision_id:parseInt(n,10),field_id:parseInt(r.field_id,10)}):s({},e,{item_id:parseInt(t,10),field_id:parseInt(e.field_id,10)}),!o.from_revision_id&&o.old_revision_id&&(o.from_revision_id=o.old_revision_id),!o.to_revision_id&&o.revision_id&&(o.to_revision_id=o.revision_id),o.field_id&&!o.field_name&&this._table&&this._table.fields.forEach(function(t){if(t.field_id==o.field_id)return o.field_name=t.name,!1}),delete o.old_revision_id,delete o.revision_id,this.push("openItemDiff",o)}},{key:"openItemDetail",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=s({},e,{item_id:parseInt(t,10)});this.push("openItemDetail",n)}},{key:"openItemList",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.push("openItemList",t)}},{key:"openUserPicker",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments[1],n=arguments[2],r={multi:!1,required:!1,title:"选择成员",placement:"right-bottom",width:300};return t=s({},r,t),["left-bottom","left-top","right-top","right-bottom"].indexOf(t.placement)<0&&(t.placement="right-bottom"),n&&y.isPC&&(t.ePos=this._getEventPosition(n)),this.send("openUserPicker",t,null,e)}},{key:"openDatePicker",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments[1],n=arguments[2],r={type:"date",placement:"right-bottom"};return t=s({},r,t),n&&y.isPC&&(t.ePos=this._getEventPosition(n)),this.send("openDatePicker",t,null,e)}},{key:"openRichEditor",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments[1],n={value:""};return t=s({},n,t),this.send("openRichEditor",t,null,e)}},{key:"openShare",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments[1],n=arguments[2],r={title:"",content:"",image:"",via:"",url:"",type:""};return t=s({},r,t),n&&y.isPC&&(t.ePos=this._getEventPosition(n)),this.send("openShare",t,null,e)}},{key:"openAttachment",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];arguments[2];return y.isPC?window.open(t.link.source):(e.file_info=t,void this.push("openAttachment",e))}},{key:"generateQrcode",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return e=s({},m,e,{text:t,render:"canvas"}),(0,p["default"])(e).toDataURL("image/png")}},{key:"genQRCode",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return e=s({},m,e,{text:t}),this.send("genQRCode",e)}},{key:"showQRCode",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2];e=s({},m,e,{text:t}),n&&y.isPC&&(e.ePos=this._getEventPosition(n)),this.push("showQRCode",e)}},{key:"scanQRCode",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return"boolean"!=typeof t.needResult&&(t.needResult=!0),this.send("scanQRCode",t)}},{key:"getLocation",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments[1],n=arguments[2],r={enableHighAccuracy:!0,timeout:5e3,maximumAge:1e4,convert:!0,title:"选择地址",placement:"left-bottom"};return t=s({},r,t),n&&y.isPC&&(t.ePos=this._getEventPosition(n)),this.send("getLocation",t,null,e)}},{key:"setPageConfig",value:function(t){this.push("setPageConfig",{config:t})}},{key:"installApplication",value:function(t){this.push("installApplication",{application_id:t})}},{key:"installPackage",value:function(t){this.push("installPackage",{package_id:t})}},{key:"_init",value:function(t){var e=this;return this.send("init",{application_id:t}).then(function(n){e._ticket=n.ticket,e._user=n.user,e._table=n.table||n.app;var r=e._table.table_id||e._table.app_id;return e._table.app_id=e._table.table_id=r,e._version=n.version,e.applicationId=t,s({},n,{app:e._table,table:e._table})})}},{key:"_getEventPosition",value:function(t){var e=t.currentTarget||t.target,n=e.getBoundingClientRect(),r=n.top,o=n.bottom,i=n.left,a=n.right,u=n.width,s=n.height,c=t.clientX,l=t.clientY,f=t.offsetX,h=t.offsetY;return{target:{top:r,bottom:o,left:i,right:a,width:u,height:s,offsetWidth:t.target.offsetWidth,offsetHeight:t.target.offsetHeight},clientX:c,clientY:l,offsetX:f,offsetY:h}}},{key:"_checkUp2V2",value:function(){var t=void 0;return t=y.isClientAndroid?(0,f["default"])(this._version,"2.4.0")>=0:y.isClientIOS?(0,f["default"])(this._version,"140")>=0:(0,f["default"])(this._version,"4.1")>=0}}]),e}(b["default"]);e["default"]=w,t.exports=e["default"]},function(t,e){t.exports=function(t,e){for(var n=t.split("."),r=e.split("."),o=0;o<3;o++){var i=Number(n[o]),a=Number(r[o]);if(i>a)return 1;if(a>i)return-1;if(!isNaN(i)&&isNaN(a))return 1;if(isNaN(i)&&!isNaN(a))return-1}return 0}},function(t,e,n){var r,o,i;/*! kjua v0.1.1 - https://larsjung.de/kjua/ */
!function(e,n){t.exports=n()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var r=n(1),o=r.createCanvas,i=r.canvasToImg,a=r.dpr,u=n(2),s=n(3),c=n(4);t.exports=function(t){var e=Object.assign({},u,t),n=s(e.text,e.ecLevel,e.minVersion,e.quiet),r=e.ratio||a,l=o(e.size,r),f=l.getContext("2d");return f.scale(r,r),c(n,f,e),"image"===e.render?i(l):l}},function(t,e){"use strict";var n=window,r=n.document,o=n.devicePixelRatio||1,i=function(t){return r.createElement(t)},a=function(t,e){return t.getAttribute(e)},u=function(t,e,n){return t.setAttribute(e,n)},s=function(t,e){var n=i("canvas");return u(n,"width",t*e),u(n,"height",t*e),n.style.width=t+"px",n.style.height=t+"px",n},c=function(t){var e=i("img");return u(e,"crossorigin","anonymous"),u(e,"src",t.toDataURL("image/png")),u(e,"width",a(t,"width")),u(e,"height",a(t,"height")),e.style.width=t.style.width,e.style.height=t.style.height,e};t.exports={createCanvas:s,canvasToImg:c,dpr:o}},function(t,e){"use strict";t.exports={render:"image",crisp:!0,minVersion:1,ecLevel:"L",size:200,ratio:null,fill:"#333",back:"#fff",text:"no text",rounded:0,quiet:0,mode:"plain",mSize:30,mPosX:50,mPosY:50,label:"no label",fontname:"sans",fontcolor:"#333",image:null}},function(n,a){"use strict";var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=/code length overflow/i,c=function(){var n=function(){function t(e,n){if("undefined"==typeof e.length)throw new Error(e.length+"/"+n);var r=function(){for(var t=0;t<e.length&&0==e[t];)t+=1;for(var r=new Array(e.length-t+n),o=0;o<e.length-t;o+=1)r[o]=e[o+t];return r}(),o={};return o.getAt=function(t){return r[t]},o.getLength=function(){return r.length},o.multiply=function(e){for(var n=new Array(o.getLength()+e.getLength()-1),r=0;r<o.getLength();r+=1)for(var i=0;i<e.getLength();i+=1)n[r+i]^=a.gexp(a.glog(o.getAt(r))+a.glog(e.getAt(i)));return t(n,0)},o.mod=function(e){if(o.getLength()-e.getLength()<0)return o;for(var n=a.glog(o.getAt(0))-a.glog(e.getAt(0)),r=new Array(o.getLength()),i=0;i<o.getLength();i+=1)r[i]=o.getAt(i);for(var i=0;i<e.getLength();i+=1)r[i]^=a.gexp(a.glog(e.getAt(i))+n);return t(r,0).mod(e)},o}var e=function(e,n){var o=236,a=17,l=e,f=r[n],h=null,d=0,p=null,y=new Array,g={},_=function(t,e){d=4*l+17,h=function(t){for(var e=new Array(t),n=0;t>n;n+=1){e[n]=new Array(t);for(var r=0;t>r;r+=1)e[n][r]=null}return e}(d),b(0,0),b(d-7,0),b(0,d-7),k(),w(),x(t,e),l>=7&&P(t),null==p&&(p=T(l,f,y)),O(p,e)},b=function(t,e){for(var n=-1;7>=n;n+=1)if(!(-1>=t+n||t+n>=d))for(var r=-1;7>=r;r+=1)-1>=e+r||e+r>=d||(n>=0&&6>=n&&(0==r||6==r)||r>=0&&6>=r&&(0==n||6==n)||n>=2&&4>=n&&r>=2&&4>=r?h[t+n][e+r]=!0:h[t+n][e+r]=!1)},m=function(){for(var t=0,e=0,n=0;8>n;n+=1){_(!0,n);var r=i.getLostPoint(g);(0==n||t>r)&&(t=r,e=n)}return e},w=function(){for(var t=8;d-8>t;t+=1)null==h[t][6]&&(h[t][6]=t%2==0);for(var e=8;d-8>e;e+=1)null==h[6][e]&&(h[6][e]=e%2==0)},k=function(){for(var t=i.getPatternPosition(l),e=0;e<t.length;e+=1)for(var n=0;n<t.length;n+=1){var r=t[e],o=t[n];if(null==h[r][o])for(var a=-2;2>=a;a+=1)for(var u=-2;2>=u;u+=1)-2==a||2==a||-2==u||2==u||0==a&&0==u?h[r+a][o+u]=!0:h[r+a][o+u]=!1}},P=function(t){for(var e=i.getBCHTypeNumber(l),n=0;18>n;n+=1){var r=!t&&1==(e>>n&1);h[Math.floor(n/3)][n%3+d-8-3]=r}for(var n=0;18>n;n+=1){var r=!t&&1==(e>>n&1);h[n%3+d-8-3][Math.floor(n/3)]=r}},x=function(t,e){for(var n=f<<3|e,r=i.getBCHTypeInfo(n),o=0;15>o;o+=1){var a=!t&&1==(r>>o&1);6>o?h[o][8]=a:8>o?h[o+1][8]=a:h[d-15+o][8]=a}for(var o=0;15>o;o+=1){var a=!t&&1==(r>>o&1);8>o?h[8][d-o-1]=a:9>o?h[8][15-o-1+1]=a:h[8][15-o-1]=a}h[d-8][8]=!t},O=function(t,e){for(var n=-1,r=d-1,o=7,a=0,u=i.getMaskFunction(e),s=d-1;s>0;s-=2)for(6==s&&(s-=1);;){for(var c=0;2>c;c+=1)if(null==h[r][s-c]){var l=!1;a<t.length&&(l=1==(t[a]>>>o&1));var f=u(r,s-c);f&&(l=!l),h[r][s-c]=l,o-=1,-1==o&&(a+=1,o=7)}if(r+=n,0>r||r>=d){r-=n,n=-n;break}}},E=function(e,n){for(var r=0,o=0,a=0,u=new Array(n.length),s=new Array(n.length),c=0;c<n.length;c+=1){var l=n[c].dataCount,f=n[c].totalCount-l;o=Math.max(o,l),a=Math.max(a,f),u[c]=new Array(l);for(var h=0;h<u[c].length;h+=1)u[c][h]=255&e.getBuffer()[h+r];r+=l;var d=i.getErrorCorrectPolynomial(f),v=t(u[c],d.getLength()-1),p=v.mod(d);s[c]=new Array(d.getLength()-1);for(var h=0;h<s[c].length;h+=1){var y=h+p.getLength()-s[c].length;s[c][h]=y>=0?p.getAt(y):0}}for(var g=0,h=0;h<n.length;h+=1)g+=n[h].totalCount;for(var _=new Array(g),b=0,h=0;o>h;h+=1)for(var c=0;c<n.length;c+=1)h<u[c].length&&(_[b]=u[c][h],b+=1);for(var h=0;a>h;h+=1)for(var c=0;c<n.length;c+=1)h<s[c].length&&(_[b]=s[c][h],b+=1);return _},T=function(t,e,n){for(var r=u.getRSBlocks(t,e),c=s(),l=0;l<n.length;l+=1){var f=n[l];c.put(f.getMode(),4),c.put(f.getLength(),i.getLengthInBits(f.getMode(),t)),f.write(c)}for(var h=0,l=0;l<r.length;l+=1)h+=r[l].dataCount;if(c.getLengthInBits()>8*h)throw new Error("code length overflow. ("+c.getLengthInBits()+">"+8*h+")");for(c.getLengthInBits()+4<=8*h&&c.put(0,4);c.getLengthInBits()%8!=0;)c.putBit(!1);for(;!(c.getLengthInBits()>=8*h)&&(c.put(o,8),!(c.getLengthInBits()>=8*h));)c.put(a,8);return E(c,r)};return g.addData=function(t){var e=c(t);y.push(e),p=null},g.isDark=function(t,e){if(0>t||t>=d||0>e||e>=d)throw new Error(t+","+e);return h[t][e]},g.getModuleCount=function(){return d},g.make=function(){_(!1,m())},g.createTableTag=function(t,e){t=t||2,e="undefined"==typeof e?4*t:e;var n="";n+='<table style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: "+e+"px;",n+='">',n+="<tbody>";for(var r=0;r<g.getModuleCount();r+=1){n+="<tr>";for(var o=0;o<g.getModuleCount();o+=1)n+='<td style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: 0px;",n+=" width: "+t+"px;",n+=" height: "+t+"px;",n+=" background-color: ",n+=g.isDark(r,o)?"#000000":"#ffffff",n+=";",n+='"/>';n+="</tr>"}return n+="</tbody>",n+="</table>"},g.createImgTag=function(t,e){t=t||2,e="undefined"==typeof e?4*t:e;var n=g.getModuleCount()*t+2*e,r=e,o=n-e;return v(n,n,function(e,n){if(e>=r&&o>e&&n>=r&&o>n){var i=Math.floor((e-r)/t),a=Math.floor((n-r)/t);return g.isDark(a,i)?0:1}return 1})},g};e.stringToBytes=function(t){for(var e=new Array,n=0;n<t.length;n+=1){var r=t.charCodeAt(n);e.push(255&r)}return e},e.createStringToBytes=function(t,e){var n=function(){for(var n=h(t),r=function(){var t=n.read();if(-1==t)throw new Error;return t},o=0,i={};;){var a=n.read();if(-1==a)break;var u=r(),s=r(),c=r(),l=String.fromCharCode(a<<8|u),f=s<<8|c;i[l]=f,o+=1}if(o!=e)throw new Error(o+" != "+e);return i}(),r="?".charCodeAt(0);return function(t){for(var e=new Array,o=0;o<t.length;o+=1){var i=t.charCodeAt(o);if(128>i)e.push(i);else{var a=n[t.charAt(o)];"number"==typeof a?(255&a)==a?e.push(a):(e.push(a>>>8),e.push(255&a)):e.push(r)}}return e}};var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},o={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},i=function(){var e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],r=1335,i=7973,u=21522,s={},c=function(t){for(var e=0;0!=t;)e+=1,t>>>=1;return e};return s.getBCHTypeInfo=function(t){for(var e=t<<10;c(e)-c(r)>=0;)e^=r<<c(e)-c(r);return(t<<10|e)^u},s.getBCHTypeNumber=function(t){for(var e=t<<12;c(e)-c(i)>=0;)e^=i<<c(e)-c(i);return t<<12|e},s.getPatternPosition=function(t){return e[t-1]},s.getMaskFunction=function(t){switch(t){case o.PATTERN000:return function(t,e){return(t+e)%2==0};case o.PATTERN001:return function(t,e){return t%2==0};case o.PATTERN010:return function(t,e){return e%3==0};case o.PATTERN011:return function(t,e){return(t+e)%3==0};case o.PATTERN100:return function(t,e){return(Math.floor(t/2)+Math.floor(e/3))%2==0};case o.PATTERN101:return function(t,e){return t*e%2+t*e%3==0};case o.PATTERN110:return function(t,e){return(t*e%2+t*e%3)%2==0};case o.PATTERN111:return function(t,e){return(t*e%3+(t+e)%2)%2==0};default:throw new Error("bad maskPattern:"+t)}},s.getErrorCorrectPolynomial=function(e){for(var n=t([1],0),r=0;e>r;r+=1)n=n.multiply(t([1,a.gexp(r)],0));return n},s.getLengthInBits=function(t,e){if(e>=1&&10>e)switch(t){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},s.getLostPoint=function(t){for(var e=t.getModuleCount(),n=0,r=0;e>r;r+=1)for(var o=0;e>o;o+=1){for(var i=0,a=t.isDark(r,o),u=-1;1>=u;u+=1)if(!(0>r+u||r+u>=e))for(var s=-1;1>=s;s+=1)0>o+s||o+s>=e||0==u&&0==s||a==t.isDark(r+u,o+s)&&(i+=1);i>5&&(n+=3+i-5)}for(var r=0;e-1>r;r+=1)for(var o=0;e-1>o;o+=1){var c=0;t.isDark(r,o)&&(c+=1),t.isDark(r+1,o)&&(c+=1),t.isDark(r,o+1)&&(c+=1),t.isDark(r+1,o+1)&&(c+=1),0!=c&&4!=c||(n+=3)}for(var r=0;e>r;r+=1)for(var o=0;e-6>o;o+=1)t.isDark(r,o)&&!t.isDark(r,o+1)&&t.isDark(r,o+2)&&t.isDark(r,o+3)&&t.isDark(r,o+4)&&!t.isDark(r,o+5)&&t.isDark(r,o+6)&&(n+=40);for(var o=0;e>o;o+=1)for(var r=0;e-6>r;r+=1)t.isDark(r,o)&&!t.isDark(r+1,o)&&t.isDark(r+2,o)&&t.isDark(r+3,o)&&t.isDark(r+4,o)&&!t.isDark(r+5,o)&&t.isDark(r+6,o)&&(n+=40);for(var l=0,o=0;e>o;o+=1)for(var r=0;e>r;r+=1)t.isDark(r,o)&&(l+=1);var f=Math.abs(100*l/e/e-50)/5;return n+=10*f},s}(),a=function(){for(var t=new Array(256),e=new Array(256),n=0;8>n;n+=1)t[n]=1<<n;for(var n=8;256>n;n+=1)t[n]=t[n-4]^t[n-5]^t[n-6]^t[n-8];for(var n=0;255>n;n+=1)e[t[n]]=n;var r={};return r.glog=function(t){if(1>t)throw new Error("glog("+t+")");return e[t]},r.gexp=function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return t[e]},r}(),u=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e=function(t,e){var n={};return n.totalCount=t,n.dataCount=e,n},n={},o=function(e,n){switch(n){case r.L:return t[4*(e-1)+0];case r.M:return t[4*(e-1)+1];case r.Q:return t[4*(e-1)+2];case r.H:return t[4*(e-1)+3];default:return}};return n.getRSBlocks=function(t,n){var r=o(t,n);if("undefined"==typeof r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+n);for(var i=r.length/3,a=new Array,u=0;i>u;u+=1)for(var s=r[3*u+0],c=r[3*u+1],l=r[3*u+2],f=0;s>f;f+=1)a.push(e(c,l));return a},n}(),s=function(){var t=new Array,e=0,n={};return n.getBuffer=function(){return t},n.getAt=function(e){var n=Math.floor(e/8);return 1==(t[n]>>>7-e%8&1)},n.put=function(t,e){for(var r=0;e>r;r+=1)n.putBit(1==(t>>>e-r-1&1))},n.getLengthInBits=function(){return e},n.putBit=function(n){var r=Math.floor(e/8);t.length<=r&&t.push(0),n&&(t[r]|=128>>>e%8),e+=1},n},c=function(t){var r=n.MODE_8BIT_BYTE,o=e.stringToBytes(t),i={};return i.getMode=function(){return r},i.getLength=function(t){return o.length},i.write=function(t){for(var e=0;e<o.length;e+=1)t.put(o[e],8)},i},l=function(){var t=new Array,e={};return e.writeByte=function(e){t.push(255&e)},e.writeShort=function(t){e.writeByte(t),e.writeByte(t>>>8)},e.writeBytes=function(t,n,r){n=n||0,r=r||t.length;for(var o=0;r>o;o+=1)e.writeByte(t[o+n])},e.writeString=function(t){for(var n=0;n<t.length;n+=1)e.writeByte(t.charCodeAt(n))},e.toByteArray=function(){return t},e.toString=function(){var e="";e+="[";for(var n=0;n<t.length;n+=1)n>0&&(e+=","),e+=t[n];return e+="]"},e},f=function(){var t=0,e=0,n=0,r="",o={},i=function(t){r+=String.fromCharCode(a(63&t))},a=function(t){if(0>t);else{if(26>t)return 65+t;if(52>t)return 97+(t-26);if(62>t)return 48+(t-52);if(62==t)return 43;if(63==t)return 47}throw new Error("n:"+t)};return o.writeByte=function(r){for(t=t<<8|255&r,e+=8,n+=1;e>=6;)i(t>>>e-6),e-=6},o.flush=function(){if(e>0&&(i(t<<6-e),t=0,e=0),n%3!=0)for(var o=3-n%3,a=0;o>a;a+=1)r+="="},o.toString=function(){return r},o},h=function(t){var e=t,n=0,r=0,o=0,i={};i.read=function(){for(;8>o;){if(n>=e.length){if(0==o)return-1;throw new Error("unexpected end of file./"+o)}var t=e.charAt(n);if(n+=1,"="==t)return o=0,-1;t.match(/^\s$/)||(r=r<<6|a(t.charCodeAt(0)),o+=6)}var i=r>>>o-8&255;return o-=8,i};var a=function(t){if(t>=65&&90>=t)return t-65;if(t>=97&&122>=t)return t-97+26;if(t>=48&&57>=t)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw new Error("c:"+t)};return i},d=function(t,e){var n=t,r=e,o=new Array(t*e),i={};i.setPixel=function(t,e,r){o[e*n+t]=r},i.write=function(t){t.writeString("GIF87a"),t.writeShort(n),t.writeShort(r),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(n),t.writeShort(r),t.writeByte(0);var e=2,o=u(e);t.writeByte(e);for(var i=0;o.length-i>255;)t.writeByte(255),t.writeBytes(o,i,255),i+=255;t.writeByte(o.length-i),t.writeBytes(o,i,o.length-i),t.writeByte(0),t.writeString(";")};var a=function(t){var e=t,n=0,r=0,o={};return o.write=function(t,o){if(t>>>o!=0)throw new Error("length over");for(;n+o>=8;)e.writeByte(255&(t<<n|r)),o-=8-n,t>>>=8-n,r=0,n=0;r=t<<n|r,n+=o},o.flush=function(){n>0&&e.writeByte(r)},o},u=function(t){for(var e=1<<t,n=(1<<t)+1,r=t+1,i=s(),u=0;e>u;u+=1)i.add(String.fromCharCode(u));i.add(String.fromCharCode(e)),i.add(String.fromCharCode(n));var c=l(),f=a(c);f.write(e,r);var h=0,d=String.fromCharCode(o[h]);for(h+=1;h<o.length;){var v=String.fromCharCode(o[h]);h+=1,i.contains(d+v)?d+=v:(f.write(i.indexOf(d),r),i.size()<4095&&(i.size()==1<<r&&(r+=1),i.add(d+v)),d=v)}return f.write(i.indexOf(d),r),f.write(n,r),f.flush(),c.toByteArray()},s=function(){var t={},e=0,n={};return n.add=function(r){if(n.contains(r))throw new Error("dup key:"+r);t[r]=e,e+=1},n.size=function(){return e},n.indexOf=function(e){return t[e]},n.contains=function(e){return"undefined"!=typeof t[e]},n};return i},v=function(t,e,n,r){for(var o=d(t,e),i=0;e>i;i+=1)for(var a=0;t>a;a+=1)o.setPixel(a,i,n(a,i));var u=l();o.write(u);for(var s=f(),c=u.toByteArray(),h=0;h<c.length;h+=1)s.writeByte(c[h]);s.flush();var v="";return v+="<img",v+=' src="',v+="data:image/gif;base64,",v+=s,v+='"',v+=' width="',v+=t,v+='"',v+=' height="',v+=e,v+='"',r&&(v+=' alt="',v+=r,v+='"'),v+="/>"};return e}();return function(n){o=[],r=n,i="function"==typeof r?r.apply(e,o):r,!(void 0!==i&&(t.exports=i))}(function(){return n}),!function(t){t.stringToBytes=function(t){function e(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);128>r?e.push(r):2048>r?e.push(192|r>>6,128|63&r):55296>r||r>=57344?e.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&t.charCodeAt(n)),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return e}return e(t)}}(n),n}(),l=function(t,e){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];n=Math.max(1,n);for(var r=n;40>=r;r+=1)try{var o=function(){var n=c(r,e);n.addData(t),n.make();var o=n.getModuleCount(),i=function(t,e){return t>=0&&o>t&&e>=0&&o>e&&n.isDark(t,e)};return{v:{text:t,level:e,version:r,moduleCount:o,isDark:i}}}();if("object"===("undefined"==typeof o?"undefined":u(o)))return o.v}catch(i){if(!s.test(i.message))throw i}return null},f=function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?"L":arguments[1],n=arguments.length<=2||void 0===arguments[2]?1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],o=l(t,e,n);return o&&!function(){var t=o.isDark;o.moduleCount+=2*r,o.isDark=function(e,n){return t(e-r,n-r)}}(),o};n.exports=f},function(t,e,n){"use strict";var r=n(5),o=n(6),i=function(t,e){t.fillStyle=e.back,t.fillRect(0,0,e.size,e.size)},a=function(t,e,n,r,o,i){t.isDark(o,i)&&e.rect(i*r,o*r,r,r)},u=function(t,e,n){if(t){var o=n.rounded>0&&n.rounded<=100?r:a,i=t.moduleCount,u=n.size/i,s=0;n.crisp&&(u=Math.floor(u),s=Math.floor((n.size-u*i)/2)),e.translate(s,s),e.beginPath();for(var c=0;i>c;c+=1)for(var l=0;i>l;l+=1)o(t,e,n,u,c,l);e.fillStyle=n.fill,e.fill(),e.translate(-s,-s)}},s=function(t,e,n){i(e,n),u(t,e,n),o(e,n)};t.exports=s},function(t,e){"use strict";var n=function(t){return{c:t,m:function(){var t;return(t=this.c).moveTo.apply(t,arguments),this},l:function(){var t;return(t=this.c).lineTo.apply(t,arguments),this},a:function(){var t;return(t=this.c).arcTo.apply(t,arguments),this}}},r=function(t,e,n,r,o,i,a,u,s,c){a?t.m(e+i,n):t.m(e,n),u?t.l(r-i,n).a(r,n,r,o,i):t.l(r,n),s?t.l(r,o-i).a(r,o,e,o,i):t.l(r,o),c?t.l(e+i,o).a(e,o,e,n,i):t.l(e,o),a?t.l(e,n+i).a(e,n,r,n,i):t.l(e,n)},o=function(t,e,n,r,o,i,a,u,s,c){a&&t.m(e+i,n).l(e,n).l(e,n+i).a(e,n,e+i,n,i),u&&t.m(r-i,n).l(r,n).l(r,n+i).a(r,n,r-i,n,i),s&&t.m(r-i,o).l(r,o).l(r,o-i).a(r,o,r-i,o,i),c&&t.m(e+i,o).l(e,o).l(e,o-i).a(e,o,e+i,o,i)},i=function(t,e,i,a,u,s){var c=s*a,l=u*a,f=c+a,h=l+a,d=.005*i.rounded*a,v=t.isDark,p=u-1,y=u+1,g=s-1,_=s+1,b=v(u,s),m=v(p,g),w=v(p,s),k=v(p,_),P=v(u,_),x=v(y,_),O=v(y,s),E=v(y,g),T=v(u,g),S=n(e);b?r(S,c,l,f,h,d,!w&&!T,!w&&!P,!O&&!P,!O&&!T):o(S,c,l,f,h,d,w&&T&&m,w&&P&&k,O&&P&&x,O&&T&&E)};t.exports=i},function(t,e){"use strict";var n=function(t,e){var n=e.size,r="bold "+.01*e.mSize*n+"px "+e.fontname;t.strokeStyle=e.back,t.lineWidth=.01*e.mSize*n*.1,t.fillStyle=e.fontcolor,t.font=r;var o=t.measureText(e.label).width,i=.01*e.mSize,a=o/n,u=(1-a)*e.mPosX*.01,s=(1-i)*e.mPosY*.01,c=u*n,l=s*n+.75*e.mSize*.01*n;t.strokeText(e.label,c,l),t.fillText(e.label,c,l)},r=function(t,e){var n=e.size,r=e.image.naturalWidth||1,o=e.image.naturalHeight||1,i=.01*e.mSize,a=i*r/o,u=(1-a)*e.mPosX*.01,s=(1-i)*e.mPosY*.01,c=u*n,l=s*n,f=a*n,h=i*n;t.drawImage(e.image,c,l,f,h)},o=function(t,e){var o=e.mode;"label"===o?n(t,e):"image"===o&&r(t,e)};t.exports=o}])})},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(13),s=r(u),c=n(7),l=r(c),f=n(1),h=function(){function t(e){o(this,t),this.connect=(0,l["default"])(),this.promises={},this.handlers={},e&&this.on(e)}return a(t,[{key:"ready",value:function(t){return this.connect.promise.then(t),this}},{key:"on",value:function(t,e,n){var r=this,o=void 0;return e||"object"!=("undefined"==typeof t?"undefined":i(t))?o=[this._on(t,e,n)]:(o=[],Object.keys(t).forEach(function(e){o.push(r._on(e,t[e],n))})),{on:this.on.bind(this),revoke:o[0],revokes:o}}},{key:"_on",value:function(t,e,n){var r=this,o=function(){};return t&&e&&(!n&&this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push(e),o=function(){r.off(t,e)}),o}},{key:"off",value:function(t,e){if(t&&this.handlers[t])if(e){var n=this.handlers[t].indexOf(e);n>=0&&this.handlers[t].splice(n,1)}else this.handlers[t]=[];else"!"==t&&(this.handlers={});return this}},{key:"emit",value:function(t,e,n){var r=[],o=!1,i=!1;if(t&&this.handlers[t]){var a=this.handlers[t];r=a.map(function(t){var r=void 0;return o||(r=t(e,n),!1===r&&(o=!0),i=!0),r})}return"*"!=t&&this.handlers["*"]&&(r=r.concat(this.handlers["*"].map(function(r){return r(t,e,i?null:n)}))),r}},{key:"push",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this.ready(function(){e._send(t,n)})}},{key:"send",value:function(t,e,n,r){var o=this,i=n||this._unique_id();if(this.ready(function(){o._send(t,e,i)}),r&&"function"==typeof r)return this.promises[i]=r,i;var a=(0,l["default"])();return this.promises[i]=a,a.promise}},{key:"handleMessage",value:function(t){var e=this;if(!1!==this._processMessage(t)){var n=void 0,r=void 0,o=void 0,i=void 0;try{if(n=t.data,"string"==typeof n&&((f.isIPhone||f.isIPad)&&(n=n.replace(/[\r\n\t]+/g,"")),n=JSON.parse(n)),!n.action&&!n.id&&!n.callback)throw new Error}catch(a){throw this.emit("error",{type:"json",source:n,err:a}),this.emit("error.json",{source:n,err:a}),alert("HB_APP_SDK: JSON解析失败, 请将当前界面截图反馈, 谢谢!\n"+JSON.stringify(a)+"\n"+n),new Error("HB_APP_SDK: malformed message")}if(r=n.id||n.callback,o=n.action,i=n.params||n.data,r){if(r in this.promises){var u=this.promises[r];u.resolve?(n.error?u.reject(n.error):n.result?u.resolve(n.result):u.reject({cancelled:!0}),this.promises[r]=null):n.result||n.error?this.promises[r](n.result,n.error):this.promises[r](null,{cancelled:!0})}else if(o&&this.handlers[o]){var s=function(t){e.send(o,t,r)};this.emit(o,i,s)}}else o?(this.emit(o,i),i&&i.action&&this.emit(o+"."+i.action,i.data)):this.emit("*",i)}}},{key:"destroy",value:function(){this.off("!"),this.connect=(0,l["default"])()}},{key:"_send",value:function(){}},{key:"_processMessage",value:function(t){return t}},{key:"_unique_id",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"cb_":arguments[0],e=arguments.length<=1||void 0===arguments[1]?10:arguments[1],n=arguments.length<=2||void 0===arguments[2]?16:arguments[2],r="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";return s["default"].generateUUID(t+r.substr(0,e),n)()}}]),t}();e["default"]=h,t.exports=e["default"]},function(t,e){function n(t,e){function n(){var e=(new Date).getTime(),n=r.length;return t.replace(/[xy]/g,function(t){var o=(e+Math.random()*n)%n|0;return e=Math.floor(e/n),r["x"===t?o:3&o|8]})}t="string"==typeof t?t:o,e="number"==typeof e?e:a;var r=i.slice(0,e);return n}var r,o="xxxxyxxxxyxxxxyxxxxy",i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a=16;r=n(),r.generateUUID=n,t.exports=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function h(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:h(o,e,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},c=n(9),l=r(c),f=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),u(e,[{key:"init",value:function(t){return this.connect.resolve(),window.HB=window.HB||{},window.HB.bridgeCallback=this.handleBridgeInvoke.bind(this,"callback"),window.HB.bridgeCancel=this.handleBridgeInvoke.bind(this,"cancel"),window.HB.bridgeEmit=this.handleBridgeInvoke.bind(this,"emit"),this._init(t)}},{key:"_send",value:function(t,e,n){var r=["huoban://hybrid?action="+encodeURIComponent(t)];n&&r.push("callback="+encodeURIComponent(n)),e&&r.push("params="+encodeURIComponent(JSON.stringify(e)));var o=r.join("&");this._invokeNative(o)}},{key:"_invokeNative",value:function(t){var e=document.createElement("iframe");e.style.width=0,e.style.height=0,e.style.display="none",e.src=t,document.body.appendChild(e),setTimeout(function(){e.parentNode.removeChild(e)},100)}},{key:"handleBridgeInvoke",value:function(t,e){return this.handleMessage({data:e})}},{key:"destroy",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),delete window.HB.bridgeCallback,delete window.HB.bridgeCancel,delete window.HB.bridgeEmit}}]),e}(l["default"]);e["default"]=f,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(14),c=r(s),l=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),u(e,[{key:"_invokeNative",value:function(t){window.prompt(t,"")}}]),e}(c["default"]);e["default"]=l,t.exports=e["default"]},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function y(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:y(o,e,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=n(7),f=r(l),h=n(1),d=n(12),v=r(d),p=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"init",value:function(){var t=this;this.heartbeatFrequency=5,this.connections={},this.handleHandshake=this._handleHandshake.bind(this),window.addEventListener("message",this.handleHandshake,!1),this.ready(function(){t.runHeartbeatDetection()})}},{key:"runHeartbeatDetection",value:function(){var t=this;this.getPorts().forEach(function(e){var n=e.client,r=(e.port,e.lastPing);r&&t.now()-r>2*t.heartbeatFrequency*1e3?(console.log("close",n,(t.now()-r)/1e3),t._close(n)):t.push(n,h.MSG_TYPES.PING)}),setTimeout(function(){t.runHeartbeatDetection()},1e3*this.heartbeatFrequency)}},{key:"destroy",value:function(t){var n=this;c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.getPorts().forEach(function(t){var e=t.client;n._close(e)}),this.connections={},t&&window.removeEventListener("message",this.handleHandshake)}},{key:"_close",value:function(t){this.connections[t]&&(this.connections[t].port.close(),this.connections[t].port.onmessage=null,delete this.connections[t])}},{key:"now",value:function(){return Date.now()}},{key:"report",value:function(){var t=0,e=this.getPorts().reduce(function(e,n){return t++,e[n.application_id]||(e[n.application_id]=0),e[n.application_id]++,e},{}),n=Object.keys(e);
console.log("当前已连接应用数：",n.length,", 已连接页面总数：",t,", 应用计数统计：",e)}},{key:"getPorts",value:function(t){var e=this;return Object.keys(this.connections).reduce(function(n,r){return t&&e.connections[r].application_id!=t||n.push(e.connections[r]),n},[])}},{key:"_handleHandshake",value:function(t){var e=this,n=t.data&&t.data.split?t.data.split(":"):[];if(3==n.length&&n[0]==h.MSG_TYPES.CONNECT&&t.ports.length){var r=function(){var r=n[1],o=n[2];if(!r||e.getPorts(r).length>=10)return t.ports[0].postMessage({action:h.MSG_TYPES.CONNECT,data:{error:{message:"Too many connections"}}}),{v:void 0};e.connections[o]={client:o,application_id:r,port:t.ports[0]};var i=function(t,n){n?(e.connections[o]&&e._send(o,h.MSG_TYPES.CONNECT,{error:{message:n}}),delete e.connections[o]):(e.connections[o].port.onmessage=e.handlePortMessage.bind(e,o),e.connect.resolve(o),e.push(o,h.MSG_TYPES.CONNECT,{result:{message:t}}))};e.emit("connect",{application_id:r,origin:t.origin,client:o},i)}();if("object"===("undefined"==typeof r?"undefined":u(r)))return r.v}}},{key:"send",value:function(t,e,n,r){var o=this,i=r||this._unique_id("h_");this.ready(function(){o._send(t,e,n,i)});var a=(0,f["default"])();return this.promises[i]=a,a.promise}},{key:"push",value:function(t,e){var n=this,r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.ready(function(){n._send(t,e,r)})}},{key:"_send",value:function(t,e,n,r){if(this.connections[t]){var o={action:e};n&&(o.data=n),r&&(o.id=r),this.connections[t].port.postMessage(o)}else this.emit("error",{type:"send",data:{message:"连接不存在"}})}},{key:"handlePortMessage",value:function(t,e){var n=this;if(!1!==this._processMessage(e,t)){if(!this.connections[t])throw new Error("message client error: "+t);var r=void 0,o=void 0,i=void 0;try{if(r=e.data,"string"==typeof r&&(r=JSON.parse(r)),!r.action&&!r.id&&r.callback)throw new Error}catch(a){throw new Error("HB_APP_SDK: malformed message")}o=r.id||r.callback,i=r.action;var u=void 0;o&&(u=function(e,r){r?n.connections[t].port.postMessage({id:o,error:r}):n.connections[t].port.postMessage({id:o,result:e})}),this.emit(i,{application_id:parseInt(this.connections[t].application_id,10),params:r.data},u)}}},{key:"_processMessage",value:function(t,e){switch(t.data.action){case h.MSG_TYPES.DISCONNECT:return this._close(e),!1;case h.MSG_TYPES.BROADCAST:return this._broadcast(this.connections[e].application_id,t.data.data,[e]),!1;case h.MSG_TYPES.PING:return this.connections[e].lastPing=this.now(),!1}}},{key:"broadcast",value:function(t,e){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this._broadcast(n,e?{action:t,data:e}:{action:t})}},{key:"_broadcast",value:function(t,e){var n=this,r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];this.getPorts(t).forEach(function(t){var o=t.client;t.port;r.indexOf(o)===-1&&n.push(o,h.MSG_TYPES.BROADCAST,e)})}}]),e}(v["default"]);e["default"]=p,t.exports=e["default"]}])});