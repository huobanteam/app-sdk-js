!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("HuobanAppSDK",[],t):"object"==typeof exports?exports.HuobanAppSDK=t():e.HuobanAppSDK=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return v.client||(a.isPC||a.isWap?v.client=new s["default"]:a.isClientAndroid||a.isAndroid?v.client=new h["default"]:a.isClientIOS||a.isIPhone?v.client=new f["default"]:v.client=new s["default"]),e&&v.client.on(e),v.client}function i(e){return v.host||(v.host=new p["default"],v.host.init()),e&&v.host.on(e),v.host}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})}),t.client=o,t.host=i;var u=n(2),s=r(u),c=n(14),f=r(c),l=n(15),h=r(l),d=n(16),p=r(d),v={}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=navigator.userAgent,r=t.isAndroid=!!n.match(/(Android);?[\s\/]+([\d.]+)?/),o=t.isIPad=!!n.match(/(iPad).*OS\s([\d_]+)/),i=t.isIPhone=!o&&!!n.match(/(iPhone\sOS)\s([\d_]+)/),a=t.isMobile=r||i||o,u=t.isInFrame=window.parent!==window,s=t.isWap=a&&u,c=(t.isPC=!a&&!s&&u,document.cookie.match(/huoban_client=(\w+)/));t.isClient=!!c,t.isClientIOS=c&&"ios"==c[1],t.isClientAndroid=c&&"android"==c[1],t.HB_HOST="*",t.MSG_TYPES={CONNECT:"$connect$",DISCONNECT:"$disconnect$",CLOSE:"$close$",PING:"$ping$",BROADCAST:"broadcast"}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function g(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:g(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},f=n(3),l=r(f),h=n(4),d=n(1),p=n(5),v=r(p),y=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"init",value:function(e){var t=(0,l["default"])();if(window.parent===window)return(0,h.delay)(function(e){t.reject({message:"无法找到宿主环境"})}),t.promise;if(!window.MessageChannel)return(0,h.delay)(function(e){t.reject({message:"您的浏览器不支持 MessageChannel"})}),t.promise;if(this._ticket&&this._user)return t.resolve({ticket:this._ticket,user:this._user,app:this._table,table:this._table,version:this._version}),t.promise;this._id=this._unique_id("c_",8);var n=new MessageChannel;return this.port=n.port1,this.port.onmessage=this.handleMessage.bind(this),window.parent.postMessage(d.MSG_TYPES.CONNECT+":"+e+":"+this._id,d.HB_HOST,[n.port2]),this._init(e)}},{key:"_send",value:function(e,t,n){var r={action:e};t&&(r.data=t),n&&(r.id=n),this.port.postMessage(r)}},{key:"_processMessage",value:function(e){var t=e.data;switch(t.action){case d.MSG_TYPES.CONNECT:return t.data.error?(this.emit("error",u({},t.data.error,{type:"connect"})),this.emit("error.connect",t.data.error)):this.connect.resolve(t.data.result),!1;case d.MSG_TYPES.CLOSE:return this.destroy(),!1;case d.MSG_TYPES.PING:return this.push(d.MSG_TYPES.PING),!1}}},{key:"handleWindowBeforeUnload",value:function(e){this._disconnect()}},{key:"_disconnect",value:function(){this.push(d.MSG_TYPES.DISCONNECT)}},{key:"destroy",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.port&&(this._disconnect(),this.port.close(),this.port=null)}}]),t}(v["default"]);t["default"]=y,e.exports=t["default"]},function(e,t,n){function r(){var e,t,n=new Promise(function(n,r){e=n,t=r});return{promise:n,resolve:e,reject:t}}var o;o=function(){return r}.call(t,n,t,e),!(void 0!==o&&(e.exports=o))},function(e,t){"use strict";function n(e){var t={key:e.field||e.key};return e.query||(e.query={}),"created_by"==e.key?t.values=e.query["in"]:"create_on"==e.key?t.values=o({},e.query):(a(e.query["in"])?c(e.query["in"][0])&&"myself"!=e.query["in"][0]?t.keywords=e.query["in"]:t.values=e.query["in"]:t.values=o({},e.query),s(e.query.em)&&(t.is_set=!e.query.em),e.query.in_field&&(t.fields=e.query.in_field),a(e.query.inc)&&(t.values=e.query.inc)),t}function r(e){var t={field:e.key,query:{}};return"created_by"==e.key?t.query["in"]=e.values:"create_on"==e.key?t.query=o({},e.values):(u(e.values)?t.query=o({},e.values):a(e.values)&&(t.query["in"]=e.values),e.keywords&&a(e.keywords)&&e.keywords.length&&(t.query["in"]=e.keywords),e.is_set!==!0&&e.is_set!==!1||(t.query.em=!e.is_set),e.fields&&(t.query.in_field=e.fields),a(e.within)&&(t.query.inc=e.within)),t}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=Object.prototype.toString,a=(t.delay=function(e,t){return setTimeout(e,t||0)},t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i.call(e)}),u=t.isObject=function(e){return"[object Object]"===i.call(e)},s=t.isBool=function(e){return"[object Boolean]"===i.call(e)},c=t.isString=function(e){return"[object String]"===i.call(e)};t.cvFiltersToV1=function f(e){var t=Object.keys(e),r={};return t.forEach(function(t){u(e[t])?r[t]=f(e[t]):a(e[t])&&(r[t]=e[t].map(n))}),r},t.cvFiltersToV2=function l(e){var t=Object.keys(e),n={};return t.forEach(function(t){u(e[t])?n[t]=l(e[t]):a(e[t])&&(n[t]=e[t].map(r))}),n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(6),f=r(c),l=n(3),h=r(l),d=n(7),p=r(d),v=n(1),y=n(4),g=n(9),_=r(g);n(11).polyfill();var b=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._ticket=null,n._user=null,n._table=null,n._version=null,n}return a(t,e),s(t,[{key:"init",value:function(e){return(0,h["default"])().promise}},{key:"openWebPage",value:function(e,t){this.push("openWebPage",{url:e,title:t})}},{key:"closeWebPage",value:function(){this.push("closeWebPage")}},{key:"setTitle",value:function(e){this.push("setTitle",{title:e})}},{key:"setNavigationBarVisibility",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.push("setNavigationBarVisibility",{is_visible:e})}},{key:"setBottomToolBarVisibility",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.push("setBottomToolBarVisibility",{is_visible:e})}},{key:"broadcast",value:function(e,t){this.push(v.MSG_TYPES.BROADCAST,t?{action:e,data:t}:{action:e})}},{key:"openUserProfile",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],r={placement:"bottom"};t=u({},r,t,{user_id:e}),n&&v.isPC&&(t.ePos=this._getEventPosition(n)),this.push("openUserProfile",t)}},{key:"getTableData",value:function(e){return this.send("getTableData",{table_id:e})}},{key:"getAppData",value:function(e){return this.getTableData(e)}},{key:"getSpaceMembers",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.send("getSpaceMembers",e)}},{key:"openFilter",value:function(e,t,n,r,o){var i={table_id:e.app_id||e.table_id,space_id:e.space_id},a=this._checkUp2V2();t&&!a&&(i.filters=(0,y.cvFiltersToV1)(t)),n&&("function"==typeof n?r=n:n>0&&(i.viewId=parseInt(n,10)));var u=void 0;return u=r&&!a?function(e){e.filters&&(e.filters=(0,y.cvFiltersToV2)(e.filters)),r(e)}:r,o&&v.isPC&&(i.ePos=this._getEventPosition(o)),this.send("openFilter",i,null,u)}},{key:"openItemDiff",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=u({},r,{item_id:parseInt(e,10),from_revision_id:parseInt(t,10),to_revision_id:parseInt(n,10),field_id:parseInt(r.field_id,10)});o.field_id&&!o.field_name&&this._table&&this._table.fields.forEach(function(e){if(e.field_id==o.field_id)return o.field_name=e.name,!1}),this.push("openItemDiff",o)}},{key:"openItemDetail",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=u({},t,{item_id:parseInt(e,10)});this.push("openItemDetail",n)}},{key:"openItemList",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.push("openItemList",e)}},{key:"openUserPicker",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],r={multi:!1,required:!1,title:"选择成员",placement:"right-bottom",width:300};return e=u({},r,e),n&&v.isPC&&(e.ePos=this._getEventPosition(n)),this.send("openUserPicker",e,null,t)}},{key:"openDatePicker",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],r={type:"date",placement:"right-bottom"};return e=u({},r,e),n&&v.isPC&&(e.ePos=this._getEventPosition(n)),this.send("openDatePicker",e,null,t)}},{key:"openRichEditor",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n={value:""};return e=u({},n,e),this.send("openRichEditor",e,null,t)}},{key:"openShare",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],r={title:"",content:"",url:"",via:""};return e=u({},r,e),n&&v.isPC&&(e.ePos=this._getEventPosition(n)),this.send("openShare",e,null,t)}},{key:"openAttachment",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];arguments[2];return v.isPC?window.open(e.link.source):(t.file_info=e,void this.push("openAttachment",t))}},{key:"generateQrcode",value:function(e){arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return p["default"].toDataURL(e,6)}},{key:"genQRCode",value:function(e){var t=(arguments.length<=1||void 0===arguments[1]?{}:arguments[1],p["default"].toDataURL(e,6));return Promise.resolve({dataURL:t})}},{key:"showQRCode",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],r={render:"image",crisp:!0,minVersion:1,ecLevel:"L",size:300,ratio:null,fill:"#333",back:"#fff",rounded:50,quiet:1,mode:"plain",mSize:30,mPosX:50,mPosY:50,label:"",fontname:"sans",fontcolor:"#333",image:null,title:null};t=u({},r,t,{text:e}),n&&v.isPC&&(t.ePos=this._getEventPosition(n)),this.push("showQRCode",t)}},{key:"scanQRCode",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return"boolean"!=typeof e.needResult&&(e.needResult=!0),this.send("scanQRCode",e)}},{key:"getLocation",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],r={enableHighAccuracy:!0,timeout:5e3,maximumAge:1e4,convert:!0,title:"选择地址",placement:"left-bottom"};return e=u({},r,e),n&&v.isPC&&(e.ePos=this._getEventPosition(n)),this.send("getLocation",e,null,t)}},{key:"setPageConfig",value:function(e){this.push("setPageConfig",{config:e})}},{key:"installApplication",value:function(e){this.push("installApplication",{application_id:e})}},{key:"_init",value:function(e){var t=this;return this.send("init",{application_id:e}).then(function(n){t._ticket=n.ticket,t._user=n.user,t._table=n.table||n.app;var r=t._table.table_id||t._table.app_id;return t._table.app_id=t._table.table_id=r,t._version=n.version,t.applicationId=e,u({},n,{app:t._table,table:t._table})})}},{key:"_getEventPosition",value:function(e){var t=e.currentTarget||e.target,n=t.getBoundingClientRect(),r=n.top,o=n.bottom,i=n.left,a=n.right,u=n.width,s=n.height;return{target:{top:r,bottom:o,left:i,right:a,width:u,height:s,offsetWidth:e.target.offsetWidth,offsetHeight:e.target.offsetHeight},clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY}}},{key:"_checkUp2V2",value:function(){var e=!1;return v.isClientAndroid?e=(0,f["default"])(this._version,"2.4.0")>=0:v.isClientIOS&&(e=(0,f["default"])(this._version,"140")>=0),e}}]),t}(_["default"]);t["default"]=b,e.exports=t["default"]},function(e,t){e.exports=function(e,t){for(var n=e.split("."),r=t.split("."),o=0;o<3;o++){var i=Number(n[o]),a=Number(r[o]);if(i>a)return 1;if(a>i)return-1;if(!isNaN(i)&&isNaN(a))return 1;if(isNaN(i)&&!isNaN(a))return-1}return 0}},function(e,t,n){var r=n(8);e.exports={typeNumber:4,errorCorrectLevel:"L",toBase64:function(e,t){var n=r(this.typeNumber,this.errorCorrectLevel);n.addData(e),n.make();var o=n.createImgBase64(t);return o},toDataURL:function(e,t){var n=this.toBase64(e,t),r="data:image/gif;base64,"+n;return r}}},function(e,t){var n=function(){function e(t,n){if("undefined"==typeof t.length)throw new Error(t.length+"/"+n);var r=function(){for(var e=0;e<t.length&&0==t[e];)e+=1;for(var r=new Array(t.length-e+n),o=0;o<t.length-e;o+=1)r[o]=t[o+e];return r}(),o={};return o.getAt=function(e){return r[e]},o.getLength=function(){return r.length},o.multiply=function(t){for(var n=new Array(o.getLength()+t.getLength()-1),r=0;r<o.getLength();r+=1)for(var i=0;i<t.getLength();i+=1)n[r+i]^=a.gexp(a.glog(o.getAt(r))+a.glog(t.getAt(i)));return e(n,0)},o.mod=function(t){if(o.getLength()-t.getLength()<0)return o;for(var n=a.glog(o.getAt(0))-a.glog(t.getAt(0)),r=new Array(o.getLength()),i=0;i<o.getLength();i+=1)r[i]=o.getAt(i);for(var i=0;i<t.getLength();i+=1)r[i]^=a.gexp(a.glog(t.getAt(i))+n);return e(r,0).mod(t)},o}var t=function(t,n){var o=236,a=17,f=t,l=r[n],h=null,d=0,y=null,g=new Array,_={},b=function(e,t){d=4*f+17,h=function(e){for(var t=new Array(e),n=0;n<e;n+=1){t[n]=new Array(e);for(var r=0;r<e;r+=1)t[n][r]=null}return t}(d),w(0,0),w(d-7,0),w(0,d-7),P(),k(),O(e,t),f>=7&&E(e),null==y&&(y=A(f,l,g)),x(y,t)},w=function(e,t){for(var n=-1;n<=7;n+=1)if(!(e+n<=-1||d<=e+n))for(var r=-1;r<=7;r+=1)t+r<=-1||d<=t+r||(0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4?h[e+n][t+r]=!0:h[e+n][t+r]=!1)},m=function(){for(var e=0,t=0,n=0;n<8;n+=1){b(!0,n);var r=i.getLostPoint(_);(0==n||e>r)&&(e=r,t=n)}return t},k=function(){for(var e=8;e<d-8;e+=1)null==h[e][6]&&(h[e][6]=e%2==0);for(var t=8;t<d-8;t+=1)null==h[6][t]&&(h[6][t]=t%2==0)},P=function(){for(var e=i.getPatternPosition(f),t=0;t<e.length;t+=1)for(var n=0;n<e.length;n+=1){var r=e[t],o=e[n];if(null==h[r][o])for(var a=-2;a<=2;a+=1)for(var u=-2;u<=2;u+=1)a==-2||2==a||u==-2||2==u||0==a&&0==u?h[r+a][o+u]=!0:h[r+a][o+u]=!1}},E=function(e){for(var t=i.getBCHTypeNumber(f),n=0;n<18;n+=1){var r=!e&&1==(t>>n&1);h[Math.floor(n/3)][n%3+d-8-3]=r}for(var n=0;n<18;n+=1){var r=!e&&1==(t>>n&1);h[n%3+d-8-3][Math.floor(n/3)]=r}},O=function(e,t){for(var n=l<<3|t,r=i.getBCHTypeInfo(n),o=0;o<15;o+=1){var a=!e&&1==(r>>o&1);o<6?h[o][8]=a:o<8?h[o+1][8]=a:h[d-15+o][8]=a}for(var o=0;o<15;o+=1){var a=!e&&1==(r>>o&1);o<8?h[8][d-o-1]=a:o<9?h[8][15-o-1+1]=a:h[8][15-o-1]=a}h[d-8][8]=!e},x=function(e,t){for(var n=-1,r=d-1,o=7,a=0,u=i.getMaskFunction(t),s=d-1;s>0;s-=2)for(6==s&&(s-=1);;){for(var c=0;c<2;c+=1)if(null==h[r][s-c]){var f=!1;a<e.length&&(f=1==(e[a]>>>o&1));var l=u(r,s-c);l&&(f=!f),h[r][s-c]=f,o-=1,o==-1&&(a+=1,o=7)}if(r+=n,r<0||d<=r){r-=n,n=-n;break}}},T=function(t,n){for(var r=0,o=0,a=0,u=new Array(n.length),s=new Array(n.length),c=0;c<n.length;c+=1){var f=n[c].dataCount,l=n[c].totalCount-f;o=Math.max(o,f),a=Math.max(a,l),u[c]=new Array(f);for(var h=0;h<u[c].length;h+=1)u[c][h]=255&t.getBuffer()[h+r];r+=f;var d=i.getErrorCorrectPolynomial(l),p=e(u[c],d.getLength()-1),v=p.mod(d);s[c]=new Array(d.getLength()-1);for(var h=0;h<s[c].length;h+=1){var y=h+v.getLength()-s[c].length;s[c][h]=y>=0?v.getAt(y):0}}for(var g=0,h=0;h<n.length;h+=1)g+=n[h].totalCount;for(var _=new Array(g),b=0,h=0;h<o;h+=1)for(var c=0;c<n.length;c+=1)h<u[c].length&&(_[b]=u[c][h],b+=1);for(var h=0;h<a;h+=1)for(var c=0;c<n.length;c+=1)h<s[c].length&&(_[b]=s[c][h],b+=1);return _},A=function(e,t,n){for(var r=u.getRSBlocks(e,t),c=s(),f=0;f<n.length;f+=1){var l=n[f];c.put(l.getMode(),4),c.put(l.getLength(),i.getLengthInBits(l.getMode(),e)),l.write(c)}for(var h=0,f=0;f<r.length;f+=1)h+=r[f].dataCount;if(c.getLengthInBits()>8*h)throw new Error("code length overflow. ("+c.getLengthInBits()+">"+8*h+")");for(c.getLengthInBits()+4<=8*h&&c.put(0,4);c.getLengthInBits()%8!=0;)c.putBit(!1);for(;;){if(c.getLengthInBits()>=8*h)break;if(c.put(o,8),c.getLengthInBits()>=8*h)break;c.put(a,8)}return T(c,r)};return _.addData=function(e){var t=c(e);g.push(t),y=null},_.isDark=function(e,t){if(e<0||d<=e||t<0||d<=t)throw new Error(e+","+t);return h[e][t]},_.getModuleCount=function(){return d},_.make=function(){b(!1,m())},_.createTableTag=function(e,t){e=e||2,t="undefined"==typeof t?4*e:t;var n="";n+='<table style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: "+t+"px;",n+='">',n+="<tbody>";for(var r=0;r<_.getModuleCount();r+=1){n+="<tr>";for(var o=0;o<_.getModuleCount();o+=1)n+='<td style="',n+=" border-width: 0px; border-style: none;",n+=" border-collapse: collapse;",n+=" padding: 0px; margin: 0px;",n+=" width: "+e+"px;",n+=" height: "+e+"px;",n+=" background-color: ",n+=_.isDark(r,o)?"#000000":"#ffffff",n+=";",n+='"/>';n+="</tr>"}return n+="</tbody>",n+="</table>"},_.createImgTag=function(e,t){e=e||2,t="undefined"==typeof t?4*e:t;var n=_.getModuleCount()*e+2*t,r=t,o=n-t;return p(n,n,function(t,n){if(r<=t&&t<o&&r<=n&&n<o){var i=Math.floor((t-r)/e),a=Math.floor((n-r)/e);return _.isDark(a,i)?0:1}return 1})},_.createImgBase64=function(e,t){e=e||2,t="undefined"==typeof t?4*e:t;var n=_.getModuleCount()*e+2*t,r=t,o=n-t;return v(n,n,function(t,n){if(r<=t&&t<o&&r<=n&&n<o){var i=Math.floor((t-r)/e),a=Math.floor((n-r)/e);return _.isDark(a,i)?0:1}return 1})},_};t.stringToBytes=function(e){for(var t=new Array,n=0;n<e.length;n+=1){var r=e.charCodeAt(n);t.push(255&r)}return t},t.createStringToBytes=function(e,t){var n=function(){for(var n=h(e),r=function(){var e=n.read();if(e==-1)throw new Error;return e},o=0,i={};;){var a=n.read();if(a==-1)break;var u=r(),s=r(),c=r(),f=String.fromCharCode(a<<8|u),l=s<<8|c;i[f]=l,o+=1}if(o!=t)throw new Error(o+" != "+t);return i}(),r="?".charCodeAt(0);return function(e){for(var t=new Array,o=0;o<e.length;o+=1){var i=e.charCodeAt(o);if(i<128)t.push(i);else{var a=n[e.charAt(o)];"number"==typeof a?(255&a)==a?t.push(a):(t.push(a>>>8),t.push(255&a)):t.push(r)}}return t}};var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},o={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},i=function(){var t=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],r=1335,i=7973,u=21522,s={},c=function(e){for(var t=0;0!=e;)t+=1,e>>>=1;return t};return s.getBCHTypeInfo=function(e){for(var t=e<<10;c(t)-c(r)>=0;)t^=r<<c(t)-c(r);return(e<<10|t)^u},s.getBCHTypeNumber=function(e){for(var t=e<<12;c(t)-c(i)>=0;)t^=i<<c(t)-c(i);return e<<12|t},s.getPatternPosition=function(e){return t[e-1]},s.getMaskFunction=function(e){switch(e){case o.PATTERN000:return function(e,t){return(e+t)%2==0};case o.PATTERN001:return function(e,t){return e%2==0};case o.PATTERN010:return function(e,t){return t%3==0};case o.PATTERN011:return function(e,t){return(e+t)%3==0};case o.PATTERN100:return function(e,t){return(Math.floor(e/2)+Math.floor(t/3))%2==0};case o.PATTERN101:return function(e,t){return e*t%2+e*t%3==0};case o.PATTERN110:return function(e,t){return(e*t%2+e*t%3)%2==0};case o.PATTERN111:return function(e,t){return(e*t%3+(e+t)%2)%2==0};default:throw new Error("bad maskPattern:"+e)}},s.getErrorCorrectPolynomial=function(t){for(var n=e([1],0),r=0;r<t;r+=1)n=n.multiply(e([1,a.gexp(r)],0));return n},s.getLengthInBits=function(e,t){if(1<=t&&t<10)switch(e){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},s.getLostPoint=function(e){for(var t=e.getModuleCount(),n=0,r=0;r<t;r+=1)for(var o=0;o<t;o+=1){for(var i=0,a=e.isDark(r,o),u=-1;u<=1;u+=1)if(!(r+u<0||t<=r+u))for(var s=-1;s<=1;s+=1)o+s<0||t<=o+s||0==u&&0==s||a==e.isDark(r+u,o+s)&&(i+=1);i>5&&(n+=3+i-5)}for(var r=0;r<t-1;r+=1)for(var o=0;o<t-1;o+=1){var c=0;e.isDark(r,o)&&(c+=1),e.isDark(r+1,o)&&(c+=1),e.isDark(r,o+1)&&(c+=1),e.isDark(r+1,o+1)&&(c+=1),0!=c&&4!=c||(n+=3)}for(var r=0;r<t;r+=1)for(var o=0;o<t-6;o+=1)e.isDark(r,o)&&!e.isDark(r,o+1)&&e.isDark(r,o+2)&&e.isDark(r,o+3)&&e.isDark(r,o+4)&&!e.isDark(r,o+5)&&e.isDark(r,o+6)&&(n+=40);for(var o=0;o<t;o+=1)for(var r=0;r<t-6;r+=1)e.isDark(r,o)&&!e.isDark(r+1,o)&&e.isDark(r+2,o)&&e.isDark(r+3,o)&&e.isDark(r+4,o)&&!e.isDark(r+5,o)&&e.isDark(r+6,o)&&(n+=40);for(var f=0,o=0;o<t;o+=1)for(var r=0;r<t;r+=1)e.isDark(r,o)&&(f+=1);var l=Math.abs(100*f/t/t-50)/5;return n+=10*l},s}(),a=function(){for(var e=new Array(256),t=new Array(256),n=0;n<8;n+=1)e[n]=1<<n;for(var n=8;n<256;n+=1)e[n]=e[n-4]^e[n-5]^e[n-6]^e[n-8];for(var n=0;n<255;n+=1)t[e[n]]=n;var r={};return r.glog=function(e){if(e<1)throw new Error("glog("+e+")");return t[e]},r.gexp=function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return e[t]},r}(),u=function(){var e=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16]],t=function(e,t){var n={};return n.totalCount=e,n.dataCount=t,n},n={},o=function(t,n){switch(n){case r.L:return e[4*(t-1)+0];case r.M:return e[4*(t-1)+1];case r.Q:return e[4*(t-1)+2];case r.H:return e[4*(t-1)+3];default:return}};return n.getRSBlocks=function(e,n){var r=o(e,n);if("undefined"==typeof r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+n);for(var i=r.length/3,a=new Array,u=0;u<i;u+=1)for(var s=r[3*u+0],c=r[3*u+1],f=r[3*u+2],l=0;l<s;l+=1)a.push(t(c,f));return a},n}(),s=function(){var e=new Array,t=0,n={};return n.getBuffer=function(){return e},n.getAt=function(t){var n=Math.floor(t/8);return 1==(e[n]>>>7-t%8&1)},n.put=function(e,t){for(var r=0;r<t;r+=1)n.putBit(1==(e>>>t-r-1&1))},n.getLengthInBits=function(){return t},n.putBit=function(n){var r=Math.floor(t/8);e.length<=r&&e.push(0),n&&(e[r]|=128>>>t%8),t+=1},n},c=function(e){var r=n.MODE_8BIT_BYTE,o=t.stringToBytes(e),i={};return i.getMode=function(){return r},i.getLength=function(e){return o.length},i.write=function(e){for(var t=0;t<o.length;t+=1)e.put(o[t],8)},i},f=function(){var e=new Array,t={};return t.writeByte=function(t){e.push(255&t)},t.writeShort=function(e){t.writeByte(e),t.writeByte(e>>>8)},t.writeBytes=function(e,n,r){n=n||0,r=r||e.length;for(var o=0;o<r;o+=1)t.writeByte(e[o+n])},t.writeString=function(e){for(var n=0;n<e.length;n+=1)t.writeByte(e.charCodeAt(n))},t.toByteArray=function(){return e},t.toString=function(){var t="";t+="[";for(var n=0;n<e.length;n+=1)n>0&&(t+=","),t+=e[n];return t+="]"},t},l=function(){var e=0,t=0,n=0,r="",o={},i=function(e){r+=String.fromCharCode(a(63&e))},a=function(e){if(e<0);else{if(e<26)return 65+e;if(e<52)return 97+(e-26);if(e<62)return 48+(e-52);if(62==e)return 43;if(63==e)return 47}throw new Error("n:"+e)};return o.writeByte=function(r){for(e=e<<8|255&r,t+=8,n+=1;t>=6;)i(e>>>t-6),t-=6},o.flush=function(){if(t>0&&(i(e<<6-t),e=0,t=0),n%3!=0)for(var o=3-n%3,a=0;a<o;a+=1)r+="="},o.toString=function(){return r},o},h=function(e){var t=e,n=0,r=0,o=0,i={};i.read=function(){for(;o<8;){if(n>=t.length){if(0==o)return-1;throw new Error("unexpected end of file./"+o)}var e=t.charAt(n);if(n+=1,"="==e)return o=0,-1;e.match(/^\s$/)||(r=r<<6|a(e.charCodeAt(0)),o+=6)}var i=r>>>o-8&255;return o-=8,i};var a=function(e){if(65<=e&&e<=90)return e-65;if(97<=e&&e<=122)return e-97+26;if(48<=e&&e<=57)return e-48+52;if(43==e)return 62;if(47==e)return 63;throw new Error("c:"+e)};return i},d=function(e,t){var n=e,r=t,o=new Array(e*t),i={};i.setPixel=function(e,t,r){o[t*n+e]=r},i.write=function(e){e.writeString("GIF87a"),e.writeShort(n),e.writeShort(r),e.writeByte(128),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(0),e.writeByte(255),e.writeByte(255),e.writeByte(255),e.writeString(","),e.writeShort(0),e.writeShort(0),e.writeShort(n),e.writeShort(r),e.writeByte(0);var t=2,o=u(t);e.writeByte(t);for(var i=0;o.length-i>255;)e.writeByte(255),e.writeBytes(o,i,255),i+=255;e.writeByte(o.length-i),e.writeBytes(o,i,o.length-i),e.writeByte(0),e.writeString(";")};var a=function(e){var t=e,n=0,r=0,o={};return o.write=function(e,o){if(e>>>o!=0)throw new Error("length over");for(;n+o>=8;)t.writeByte(255&(e<<n|r)),o-=8-n,e>>>=8-n,r=0,n=0;r=e<<n|r,n+=o},o.flush=function(){n>0&&t.writeByte(r)},o},u=function(e){for(var t=1<<e,n=(1<<e)+1,r=e+1,i=s(),u=0;u<t;u+=1)i.add(String.fromCharCode(u));i.add(String.fromCharCode(t)),i.add(String.fromCharCode(n));var c=f(),l=a(c);l.write(t,r);var h=0,d=String.fromCharCode(o[h]);for(h+=1;h<o.length;){var p=String.fromCharCode(o[h]);h+=1,i.contains(d+p)?d+=p:(l.write(i.indexOf(d),r),i.size()<4095&&(i.size()==1<<r&&(r+=1),i.add(d+p)),d=p)}return l.write(i.indexOf(d),r),l.write(n,r),l.flush(),c.toByteArray()},s=function(){var e={},t=0,n={};return n.add=function(r){if(n.contains(r))throw new Error("dup key:"+r);e[r]=t,t+=1},n.size=function(){return t},n.indexOf=function(t){return e[t]},n.contains=function(t){return"undefined"!=typeof e[t]},n};return i},p=function(e,t,n,r){for(var o=d(e,t),i=0;i<t;i+=1)for(var a=0;a<e;a+=1)o.setPixel(a,i,n(a,i));var u=f();o.write(u);for(var s=l(),c=u.toByteArray(),h=0;h<c.length;h+=1)s.writeByte(c[h]);s.flush();var p="";return p+="<img",p+=' src="',p+="data:image/gif;base64,",p+=s,p+='"',p+=' width="',p+=e,p+='"',p+=' height="',p+=t,p+='"',r&&(p+=' alt="',p+=r,p+='"'),p+="/>"},v=function(e,t,n){for(var r=d(e,t),o=0;o<t;o+=1)for(var i=0;i<e;i+=1)r.setPixel(i,o,n(i,o));var a=f();r.write(a);for(var u=l(),s=a.toByteArray(),c=0;c<s.length;c+=1)u.writeByte(s[c]);return u.flush(),u.toString()};return t}();e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(10),s=r(u),c=n(3),f=r(c),l=n(1),h=function(){function e(t){o(this,e),this.connect=(0,f["default"])(),this.promises={},this.handlers={},t&&this.on(t)}return a(e,[{key:"ready",value:function(e){return this.connect.promise.then(e),this}},{key:"on",value:function(e,t,n){var r=this,o=void 0;return t||"object"!=("undefined"==typeof e?"undefined":i(e))?o=[this._on(e,t,n)]:(o=[],Object.keys(e).forEach(function(t){o.push(r._on(t,e[t],n))})),{on:this.on.bind(this),revoke:o[0],revokes:o}}},{key:"_on",value:function(e,t,n){var r=this,o=function(){};return e&&t&&(!n&&this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t),o=function(){r.off(e,t)}),o}},{key:"off",value:function(e,t){if(e&&this.handlers[e])if(t){var n=this.handlers[e].indexOf(t);n>=0&&this.handlers[e].splice(n,1)}else this.handlers[e]=[];else"!"==e&&(this.handlers={});return this}},{key:"emit",value:function(e,t,n){var r=[],o=!1;if(e&&this.handlers[e]){var i=this.handlers[e];r=i.map(function(e){var r=void 0;return o||(r=e(t,n),!1===r&&(o=!0)),r})}return"*"!=e&&this.handlers["*"]&&(r=r.concat(this.handlers["*"].map(function(n){return n(e,t)}))),r}},{key:"push",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this.ready(function(){t._send(e,n)})}},{key:"send",value:function(e,t,n,r){var o=this,i=n||this._unique_id();if(this.ready(function(){o._send(e,t,i)}),r&&"function"==typeof r)return this.promises[i]=r,i;var a=(0,f["default"])();return this.promises[i]=a,a.promise}},{key:"handleMessage",value:function(e){var t=this;if(!1!==this._processMessage(e)){var n=void 0,r=void 0,o=void 0,i=void 0;try{if(n=e.data,"string"==typeof n&&((l.isIPhone||l.isIPad)&&(n=n.replace(/[\r\n\t]+/g,"")),n=JSON.parse(n)),!n.action&&!n.id&&!n.callback)throw new Error}catch(a){throw this.emit("error",{type:"json",source:n,err:a}),this.emit("error.json",{source:n,err:a}),alert("HB_APP_SDK: json parse fail\n"+n),new Error("HB_APP_SDK: malformed message")}if(r=n.id||n.callback,o=n.action,i=n.params||n.data,r){if(r in this.promises){var u=this.promises[r];u.resolve?(n.error?u.reject(n.error):n.result?u.resolve(n.result):u.reject({cancelled:!0}),this.promises[r]=null):n.result||n.error?this.promises[r](n.result,n.error):this.promises[r](null,{
cancelled:!0})}else if(o&&this.handlers[o]){var s=function(e){t.send(o,e,r)};this.emit(o,i,s)}}else o?(this.emit(o,i),i&&i.action&&this.emit(o+"."+i.action,i.data)):this.emit("*",i)}}},{key:"destroy",value:function(){this.off("!"),this.connect=(0,f["default"])()}},{key:"_send",value:function(){}},{key:"_processMessage",value:function(e){return e}},{key:"_unique_id",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"cb_":arguments[0],t=arguments.length<=1||void 0===arguments[1]?10:arguments[1],n=arguments.length<=2||void 0===arguments[2]?16:arguments[2],r="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";return s["default"].generateUUID(e+r.substr(0,t),n)()}}]),e}();t["default"]=h,e.exports=t["default"]},function(e,t){function n(e,t){function n(){var t=(new Date).getTime(),n=r.length;return e.replace(/[xy]/g,function(e){var o=(t+Math.random()*n)%n|0;return t=Math.floor(t/n),r["x"===e?o:3&o|8]})}e="string"==typeof e?e:o,t="number"==typeof t?t:a;var r=i.slice(0,t);return n}var r,o="xxxxyxxxxyxxxxyxxxxy",i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a=16;r=n(),r.generateUUID=n,e.exports=r},function(e,t,n){(function(t,r){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function i(e){$=e}function a(e){J=e}function u(){return function(){return t.nextTick(h)}}function s(){return"undefined"!=typeof Q?function(){Q(h)}:l()}function c(){var e=0,t=new Z(h),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function f(){var e=new MessageChannel;return e.port1.onmessage=h,function(){return e.port2.postMessage(0)}}function l(){var e=setTimeout;return function(){return e(h,1)}}function h(){for(var e=0;e<W;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}W=0}function d(){try{var e=n(13);return Q=e.runOnLoop||e.runOnContext,s()}catch(t){return l()}}function p(e,t){var n=arguments,r=this,o=new this.constructor(y);void 0===o[oe]&&N(o);var i=r._state;return i?!function(){var e=n[i-1];J(function(){return B(i,o,e,r._result)})}():A(r,o,e,t),o}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(y);return E(n,e),n}function y(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function b(e){try{return e.then}catch(t){return se.error=t,se}}function w(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function m(e,t,n){J(function(e){var r=!1,o=w(n,t,function(n){r||(r=!0,t!==n?E(e,n):x(e,n))},function(t){r||(r=!0,T(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,T(e,o))},e)}function k(e,t){t._state===ae?x(e,t._result):t._state===ue?T(e,t._result):A(t,void 0,function(t){return E(e,t)},function(t){return T(e,t)})}function P(e,t,n){t.constructor===e.constructor&&n===p&&t.constructor.resolve===v?k(e,t):n===se?T(e,se.error):void 0===n?x(e,t):o(n)?m(e,t,n):x(e,t)}function E(t,n){t===n?T(t,g()):e(n)?P(t,n,b(n)):x(t,n)}function O(e){e._onerror&&e._onerror(e._result),M(e)}function x(e,t){e._state===ie&&(e._result=t,e._state=ae,0!==e._subscribers.length&&J(M,e))}function T(e,t){e._state===ie&&(e._state=ue,e._result=t,J(O,e))}function A(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+ae]=n,o[i+ue]=r,0===i&&e._state&&J(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)r=t[a],o=t[a+n],r?B(n,r,o,i):o(i);e._subscribers.length=0}}function C(){this.error=null}function S(e,t){try{return e(t)}catch(n){return ce.error=n,ce}}function B(e,t,n,r){var i=o(n),a=void 0,u=void 0,s=void 0,c=void 0;if(i){if(a=S(n,r),a===ce?(c=!0,u=a.error,a=null):s=!0,t===a)return void T(t,_())}else a=r,s=!0;t._state!==ie||(i&&s?E(t,a):c?T(t,u):e===ae?x(t,a):e===ue&&T(t,a))}function j(e,t){try{t(function(t){E(e,t)},function(t){T(e,t)})}catch(n){T(e,n)}}function D(){return fe++}function N(e){e[oe]=fe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function I(e,t){this._instanceConstructor=e,this.promise=new e(y),this.promise[oe]||N(this.promise),V(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):T(this.promise,L())}function L(){return new Error("Array Methods must be provided an Array")}function R(e){return new I(this,e).promise}function H(e){var t=this;return new t(V(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function q(e){var t=this,n=new t(y);return T(n,e),n}function Y(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function G(e){this[oe]=D(),this._result=this._state=void 0,this._subscribers=[],y!==e&&("function"!=typeof e&&Y(),this instanceof G?j(this,e):U())}function F(){var e=void 0;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var o=null;try{o=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===o&&!n.cast)return}e.Promise=G}var K=void 0;K=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var V=K,W=0,Q=void 0,$=void 0,J=function(e,t){ne[W]=e,ne[W+1]=t,W+=2,2===W&&($?$(h):re())},z="undefined"!=typeof window?window:void 0,X=z||{},Z=X.MutationObserver||X.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),re=void 0;re=ee?u():Z?c():te?f():void 0===z?d():l();var oe=Math.random().toString(36).substring(16),ie=void 0,ae=1,ue=2,se=new C,ce=new C,fe=0;return I.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===ie&&n<e;n++)this._eachEntry(t[n],n)},I.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===v){var o=b(e);if(o===p&&e._state!==ie)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===G){var i=new n(y);P(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},I.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ie&&(this._remaining--,e===ue?T(r,n):this._result[t]=n),0===this._remaining&&x(r,this._result)},I.prototype._willSettleAt=function(e,t){var n=this;A(e,void 0,function(e){return n._settledAt(ae,t,e)},function(e){return n._settledAt(ue,t,e)})},G.all=R,G.race=H,G.resolve=v,G.reject=q,G._setScheduler=i,G._setAsap=a,G._asap=J,G.prototype={constructor:G,then:p,"catch":function(e){return this.then(null,e)}},G.polyfill=F,G.Promise=G,G})}).call(t,n(12),function(){return this}())},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function i(e){if(l===clearTimeout)return clearTimeout(e);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function a(){v&&d&&(v=!1,d.length?p=d.concat(p):y=-1,p.length&&u())}function u(){if(!v){var e=o(a);v=!0;for(var t=p.length;t;){for(d=p,p=[];++y<t;)d&&d[y].run();y=-1,t=p.length}d=null,v=!1,i(e)}}function s(e,t){this.fun=e,this.array=t}function c(){}var f,l,h=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(e){l=r}}();var d,p=[],v=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new s(e,t)),1!==p.length||v||o(u)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function h(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:h(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},c=n(5),f=r(c),l=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"init",value:function(e){return this.connect.resolve(),window.HB=window.HB||{},window.HB.bridgeCallback=this.handleBridgeInvoke.bind(this,"callback"),window.HB.bridgeCancel=this.handleBridgeInvoke.bind(this,"cancel"),window.HB.bridgeEmit=this.handleBridgeInvoke.bind(this,"emit"),this._init(e)}},{key:"_send",value:function(e,t,n){var r=["huoban://hybrid?action="+encodeURIComponent(e)];n&&r.push("callback="+encodeURIComponent(n)),t&&r.push("params="+encodeURIComponent(JSON.stringify(t)));var o=r.join("&");this._invokeNative(o)}},{key:"_invokeNative",value:function(e){var t=document.createElement("iframe");t.style.width=0,t.style.height=0,t.style.display="none",t.src=e,document.body.appendChild(t),setTimeout(function(){t.parentNode.removeChild(t)},100)}},{key:"handleBridgeInvoke",value:function(e,t){return this.handleMessage({data:t})}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),delete window.HB.bridgeCallback,delete window.HB.bridgeCancel,delete window.HB.bridgeEmit}}]),t}(f["default"]);t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(14),c=r(s),f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"_invokeNative",value:function(e){window.prompt(e,"")}}]),t}(c["default"]);t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function y(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:y(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},f=n(3),l=r(f),h=n(1),d=n(9),p=r(d),v=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"init",value:function(){var e=this;this.heartbeatFrequency=5,this.connections={},this.handleHandshake=this._handleHandshake.bind(this),window.addEventListener("message",this.handleHandshake,!1),this.ready(function(t){e.runHeartbeatDetection()})}},{key:"runHeartbeatDetection",value:function(){var e=this;this.getPorts().forEach(function(t){var n=t.client,r=(t.port,t.lastPing);r&&e.now()-r>2*e.heartbeatFrequency*1e3?(console.log("close",n,(e.now()-r)/1e3),e._close(n)):e.push(n,h.MSG_TYPES.PING)}),setTimeout(function(t){e.runHeartbeatDetection()},1e3*this.heartbeatFrequency)}},{key:"destroy",value:function(e){var n=this;c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.getPorts().forEach(function(e){var t=e.client;n._close(t)}),this.connections={},e&&window.removeEventListener("message",this.handleHandshake)}},{key:"_close",value:function(e){this.connections[e]&&(this.connections[e].port.close(),this.connections[e].port.onmessage=null,delete this.connections[e])}},{key:"now",value:function(){return Date.now()}},{key:"report",value:function(){var e=0,t=this.getPorts().reduce(function(t,n){return e++,t[n.application_id]||(t[n.application_id]=0),t[n.application_id]++,t},{}),n=Object.keys(t);console.log("当前已连接应用数：",n.length,", 已连接页面总数：",e,", 应用计数统计：",t)}},{key:"getPorts",value:function(e){var t=this;return Object.keys(this.connections).reduce(function(n,r){return e&&t.connections[r].application_id!=e||n.push(t.connections[r]),n},[])}},{key:"_handleHandshake",value:function(e){var t=this,n=e.data&&e.data.split?e.data.split(":"):[];if(3==n.length&&n[0]==h.MSG_TYPES.CONNECT&&e.ports.length){var r=function(){var r=n[1],o=n[2];if(!r||t.getPorts(r).length>=10)return e.ports[0].postMessage({action:h.MSG_TYPES.CONNECT,data:{error:{message:"Too many connections"}}}),{v:void 0};t.connections[o]={client:o,application_id:r,port:e.ports[0]};var i=function(e,n){n?(t.connections[o]&&t._send(o,h.MSG_TYPES.CONNECT,{error:{message:n}}),delete t.connections[o]):(t.connections[o].port.onmessage=t.handlePortMessage.bind(t,o),t.connect.resolve(o),t.push(o,h.MSG_TYPES.CONNECT,{result:{message:e}}))};t.emit("connect",{application_id:r,origin:e.origin,client:o},i)}();if("object"===("undefined"==typeof r?"undefined":u(r)))return r.v}}},{key:"send",value:function(e,t,n,r){var o=this,i=r||this._unique_id("h_");this.ready(function(){o._send(e,t,n,i)});var a=(0,l["default"])();return this.promises[i]=a,a.promise}},{key:"push",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.ready(function(){n._send(e,t,r)})}},{key:"_send",value:function(e,t,n,r){if(this.connections[e]){var o={action:t};n&&(o.data=n),r&&(o.id=r),this.connections[e].port.postMessage(o)}else this.emit("error",{type:"send",data:{message:"连接不存在"}})}},{key:"handlePortMessage",value:function(e,t){var n=this;if(!1!==this._processMessage(t,e)){if(!this.connections[e])throw new Error("message client error: "+e);var r=void 0,o=void 0,i=void 0;try{if(r=t.data,"string"==typeof r&&(r=JSON.parse(r)),!r.action&&!r.id&&r.callback)throw new Error}catch(a){throw new Error("HB_APP_SDK: malformed message")}o=r.id||r.callback,i=r.action;var u=void 0;o&&(u=function(t,r){r?n.connections[e].port.postMessage({id:o,error:r}):n.connections[e].port.postMessage({id:o,result:t})}),this.emit(i,{application_id:parseInt(this.connections[e].application_id,10),params:r.data},u)}}},{key:"_processMessage",value:function(e,t){switch(e.data.action){case h.MSG_TYPES.DISCONNECT:return this._close(t),!1;case h.MSG_TYPES.BROADCAST:return this._broadcast(this.connections[t].application_id,e.data.data,[t]),!1;case h.MSG_TYPES.PING:return this.connections[t].lastPing=this.now(),!1}}},{key:"broadcast",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this._broadcast(n,t?{action:e,data:t}:{action:e})}},{key:"_broadcast",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];this.getPorts(e).forEach(function(e){var o=e.client;e.port;r.indexOf(o)===-1&&n.push(o,h.MSG_TYPES.BROADCAST,t)})}}]),t}(p["default"]);t["default"]=v,e.exports=t["default"]}])});
//# sourceMappingURL=HuobanAppSDK.min.js.map