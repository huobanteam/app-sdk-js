!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("HuobanAppSDK",[],t):"object"==typeof exports?exports.HuobanAppSDK=t():e.HuobanAppSDK=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e){return v.client||(s.isPC||s.isWap?v.client=new u["default"]:s.isClientIOS||s.isIPhone?v.client=new l["default"]:s.isClientAndroid&&s.isAndroid?v.client=new h["default"]:v.client=new u["default"]),e&&v.client.on(e),v.client}function o(e){return v.host||(v.host=new p["default"],v.host.init()),e&&v.host.on(e),v.host}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}),t.client=r,t.host=o,n(2);var a=n(6),u=i(a),c=n(13),l=i(c),f=n(14),h=i(f),d=n(15),p=i(d),v={}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=navigator.userAgent,i=t.isAndroid=!!n.match(/(Android);?[\s\/]+([\d.]+)?/),r=t.isIPad=!!n.match(/(iPad).*OS\s([\d_]+)/),o=t.isIPhone=!r&&!!n.match(/(iPhone\sOS)\s([\d_]+)/),s=t.isMobile=i||o||r,a=t.isInFrame=window.parent!==window,u=t.isWap=s&&a,c=(t.isPC=!s&&!u&&a,document.cookie.match(/huoban_client=(\w+)/));t.isClient=!!c,t.isClientIOS=c&&"ios"==c[1],t.isClientAndroid=c&&"android"==c[1],t.HB_HOST="*",t.MSG_TYPES={CONNECT:"$connect$",DISCONNECT:"$disconnect$",CLOSE:"$close$",PING:"$ping$",BROADCAST:"broadcast"}},function(e,t,n){"use strict";n(3).polyfill(),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e})},function(e,t,n){(function(t,i){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.0.5
	 */
!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function o(e){Q=e}function s(e){J=e}function a(){return function(){return t.nextTick(h)}}function u(){return"undefined"!=typeof $?function(){$(h)}:f()}function c(){var e=0,t=new Z(h),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=h,function(){return e.port2.postMessage(0)}}function f(){var e=setTimeout;return function(){return e(h,1)}}function h(){for(var e=0;e<K;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}K=0}function d(){try{var e=n(5);return $=e.runOnLoop||e.runOnContext,u()}catch(t){return f()}}function p(e,t){var n=arguments,i=this,r=new this.constructor(y);void 0===r[re]&&q(r);var o=i._state;return o?!function(){var e=n[o-1];J(function(){return A(o,r,e,i._result)})}():E(i,r,e,t),r}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(y);return O(n,e),n}function y(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function b(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(t){return ue.error=t,ue}}function m(e,t,n,i){try{e.call(t,n,i)}catch(r){return r}}function w(e,t,n){J(function(e){var i=!1,r=m(n,t,function(n){i||(i=!0,t!==n?O(e,n):j(e,n))},function(t){i||(i=!0,S(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&r&&(i=!0,S(e,r))},e)}function k(e,t){t._state===se?j(e,t._result):t._state===ae?S(e,t._result):E(t,void 0,function(t){return O(e,t)},function(t){return S(e,t)})}function P(e,t,n){t.constructor===e.constructor&&n===p&&t.constructor.resolve===v?k(e,t):n===ue?S(e,ue.error):void 0===n?j(e,t):r(n)?w(e,t,n):j(e,t)}function O(t,n){t===n?S(t,_()):e(n)?P(t,n,g(n)):j(t,n)}function x(e){e._onerror&&e._onerror(e._result),T(e)}function j(e,t){e._state===oe&&(e._result=t,e._state=se,0!==e._subscribers.length&&J(T,e))}function S(e,t){e._state===oe&&(e._state=ae,e._result=t,J(x,e))}function E(e,t,n,i){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+se]=n,r[o+ae]=i,0===o&&e._state&&J(T,e)}function T(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,o=e._result,s=0;s<t.length;s+=3)i=t[s],r=t[s+n],i?A(n,i,r,o):r(o);e._subscribers.length=0}}function C(){this.error=null}function M(e,t){try{return e(t)}catch(n){return ce.error=n,ce}}function A(e,t,n,i){var o=r(n),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if(s=M(n,i),s===ce?(c=!0,a=s.error,s=null):u=!0,t===s)return void S(t,b())}else s=i,u=!0;t._state!==oe||(o&&u?O(t,s):c?S(t,a):e===se?j(t,s):e===ae&&S(t,s))}function N(e,t){try{t(function(t){O(e,t)},function(t){S(e,t)})}catch(n){S(e,n)}}function I(){return le++}function q(e){e[re]=le++,e._state=void 0,e._result=void 0,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(y),this.promise[re]||q(this.promise),W(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?j(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&j(this.promise,this._result))):S(this.promise,B())}function B(){return new Error("Array Methods must be provided an Array")}function H(e){return new D(this,e).promise}function Y(e){var t=this;return new t(W(e)?function(n,i){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function R(e){var t=this,n=new t(y);return S(n,e),n}function G(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(e){this[re]=I(),this._result=this._state=void 0,this._subscribers=[],y!==e&&("function"!=typeof e&&G(),this instanceof U?N(this,e):F())}function L(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=U}var V=void 0;V=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var W=V,K=0,$=void 0,Q=void 0,J=function(e,t){ne[K]=e,ne[K+1]=t,K+=2,2===K&&(Q?Q(h):ie())},X="undefined"!=typeof window?window:void 0,z=X||{},Z=z.MutationObserver||z.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),ie=void 0;ie=ee?a():Z?c():te?l():void 0===X?d():f();var re=Math.random().toString(36).substring(16),oe=void 0,se=1,ae=2,ue=new C,ce=new C,le=0;return D.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===oe&&n<e;n++)this._eachEntry(t[n],n)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===v){var r=g(e);if(r===p&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===U){var o=new n(y);P(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},D.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===oe&&(this._remaining--,e===ae?S(i,n):this._result[t]=n),0===this._remaining&&j(i,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;E(e,void 0,function(e){return n._settledAt(se,t,e)},function(e){return n._settledAt(ae,t,e)})},U.all=H,U.race=Y,U.resolve=v,U.reject=R,U._setScheduler=o,U._setAsap=s,U._asap=J,U.prototype={constructor:U,then:p,"catch":function(e){return this.then(null,e)}},U.polyfill=L,U.Promise=U,U})}).call(t,n(4),function(){return this}())},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){v&&d&&(v=!1,d.length?p=d.concat(p):y=-1,p.length&&a())}function a(){if(!v){var e=r(s);v=!0;for(var t=p.length;t;){for(d=p,p=[];++y<t;)d&&d[y].run();y=-1,t=p.length}d=null,v=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,h=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var d,p=[],v=!1,y=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new u(e,t)),1!==p.length||v||r(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t){},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function _(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:_(r,t,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},l=n(7),f=i(l),h=n(8),d=n(1),p=n(9),v=i(p),y=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),u(t,[{key:"init",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=(0,f["default"])();if(window.parent===window)return(0,h.delay)(function(){n.reject({message:"无法找到宿主环境"})}),n.promise;if(!window.MessageChannel)return(0,h.delay)(function(){n.reject({message:"您的浏览器不支持 MessageChannel"})}),n.promise;if(this._ticket&&this._user)return n.resolve({ticket:this._ticket,user:this._user,app:this._table,table:this._table,version:this._version}),n.promise;this._id=this._unique_id("c_",8);var i=new MessageChannel;return this.port=i.port1,this.port.onmessage=this.handleMessage.bind(this),window.parent.postMessage(d.MSG_TYPES.CONNECT+":"+e+":"+this._id,d.HB_HOST,[i.port2]),this._init(e,t)}},{key:"_send",value:function(e,t,n){var i={action:e};t&&(i.data=t),n&&(i.id=n),this.port.postMessage(i)}},{key:"_processMessage",value:function(e){var t=e.data;switch(t.action){case d.MSG_TYPES.CONNECT:return t.data.error?(this.emit("error",a({},t.data.error,{type:"connect"})),this.emit("error.connect",t.data.error)):this.connect.resolve(t.data.result),!1;case d.MSG_TYPES.CLOSE:return this.destroy(),!1;case d.MSG_TYPES.PING:return this.push(d.MSG_TYPES.PING),!1}}},{key:"handleWindowBeforeUnload",value:function(e){this._disconnect()}},{key:"_disconnect",value:function(){this.push(d.MSG_TYPES.DISCONNECT)}},{key:"destroy",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.port&&(this._disconnect(),this.port.close(),this.port=null)}}]),t}(v["default"]);t["default"]=y,e.exports=t["default"]},function(e,t,n){function i(){var e,t,n=new Promise(function(n,i){e=n,t=i});return{promise:n,resolve:e,reject:t}}var r;r=function(){return i}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t){"use strict";function n(e){var t={key:e.field||e.key};return e.query||(e.query={}),"created_by"==e.key?t.values=e.query["in"]:"create_on"==e.key?t.values=r({},e.query):(s(e.query["in"])?c(e.query["in"][0])&&"myself"!=e.query["in"][0]?t.keywords=e.query["in"]:t.values=e.query["in"]:t.values=r({},e.query),u(e.query.em)&&(t.is_set=!e.query.em),e.query.in_field&&(t.fields=e.query.in_field),s(e.query.inc)&&(t.values=e.query.inc)),t}function i(e){var t={field:e.key,query:{}};return"created_by"==e.key?t.query["in"]=e.values:"create_on"==e.key?t.query=r({},e.values):(a(e.values)?t.query=r({},e.values):s(e.values)&&(t.query["in"]=e.values),e.keywords&&s(e.keywords)&&e.keywords.length&&(t.query["in"]=e.keywords),e.is_set!==!0&&e.is_set!==!1||(t.query.em=!e.is_set),e.fields&&(t.query.in_field=e.fields),s(e.within)&&(t.query.inc=e.within)),t}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=Object.prototype.toString,s=(t.delay=function(e,t){return setTimeout(e,t||0)},t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===o.call(e)}),a=t.isObject=function(e){return"[object Object]"===o.call(e)},u=t.isBool=function(e){return"[object Boolean]"===o.call(e)},c=t.isString=function(e){return"[object String]"===o.call(e)};t.cvFiltersToV1=function l(e){var t=Object.keys(e),i={};return t.forEach(function(t){a(e[t])?i[t]=l(e[t]):s(e[t])&&(i[t]=e[t].map(n))}),i},t.cvFiltersToV2=function f(e){var t=Object.keys(e),n={};return t.forEach(function(t){a(e[t])?n[t]=f(e[t]):s(e[t])&&(n[t]=e[t].map(i))}),n}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(10),f=i(l),h=n(7),d=i(h),p=n(1),v=n(8),y=n(11),_=i(y),b={render:"image",crisp:!0,minVersion:1,ecLevel:"L",size:300,ratio:null,fill:"#333",back:"#fff",rounded:50,quiet:1,mode:"plain",mSize:30,mPosX:50,mPosY:50,label:"",fontname:"sans",fontcolor:"#333",image:null,title:null,text:""},g=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._ticket=null,n._user=null,n._table=null,n._version=null,n}return s(t,e),c(t,[{key:"init",value:function(e){arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return(0,d["default"])().promise}},{key:"openWebPage",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this.push("openWebPage",u({},n,{url:e,title:t}))}},{key:"closeWebPage",value:function(){this.push("closeWebPage")}},{key:"setTitle",value:function(e){this.push("setTitle",{title:e})}},{key:"setNavigationBarVisibility",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.push("setNavigationBarVisibility",{is_visible:e})}},{key:"setBottomToolBarVisibility",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.push("setBottomToolBarVisibility",{is_visible:e})}},{key:"broadcast",value:function(e,t){this.push(p.MSG_TYPES.BROADCAST,t?{action:e,data:t}:{action:e})}},{key:"openUserProfile",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],i={placement:"bottom"};t=u({},i,t,{user_id:e}),n&&p.isPC&&(t.ePos=this._getEventPosition(n)),this.push("openUserProfile",t)}},{key:"getTableData",value:function(e){return this.send("getTableData",{table_id:e})}},{key:"getSpaceMembers",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return this.send("getSpaceMembers",e)}},{key:"openFilter",value:function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2];1==arguments.length?(e=this.table,n=arguments.length<=0?void 0:arguments[0]):2==arguments.length?(e=this.table,t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1]):3==arguments.length&&(e=e&&e.table_id?e:this.table);var i={table_id:e.table_id,space_id:e.space_id},r=this._checkUp2V2();t&&["object","function"].indexOf("undefined"==typeof t?"undefined":a(t))>=0&&0!==t.length&&(i.filters=r?t:(0,v.cvFiltersToV1)(t));var o=void 0;return o=n&&!r?function(e){e.filters&&(e.filters=(0,v.cvFiltersToV2)(e.filters)),n(e)}:n,this.send("openFilter",i,null,o)}},{key:"openItemDiff",value:function(e,t,n,i){var r=void 0;r=n||i||!t?u({},i,{item_id:parseInt(e,10),from_revision_id:parseInt(t,10),to_revision_id:parseInt(n,10),field_id:parseInt(i.field_id,10)}):u({},t,{item_id:parseInt(e,10),field_id:parseInt(t.field_id,10)}),!r.from_revision_id&&r.old_revision_id&&(r.from_revision_id=r.old_revision_id),!r.to_revision_id&&r.revision_id&&(r.to_revision_id=r.revision_id),r.field_id&&!r.field_name&&this._table&&this._table.fields.forEach(function(e){if(e.field_id==r.field_id)return r.field_name=e.name,!1}),delete r.old_revision_id,delete r.revision_id,this.push("openItemDiff",r)}},{key:"openItemDetail",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=u({},t,{item_id:parseInt(e,10)});this.push("openItemDetail",n)}},{key:"openItemList",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.push("openItemList",e)}},{key:"openUserPicker",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],i={multi:!1,required:!1,title:"选择成员",placement:"right-bottom",width:300};return e=u({},i,e),["left-bottom","left-top","right-top","right-bottom"].indexOf(e.placement)<0&&(e.placement="right-bottom"),n&&p.isPC&&(e.ePos=this._getEventPosition(n)),this.send("openUserPicker",e,null,t)}},{key:"openDatePicker",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],i={type:"date",placement:"right-bottom"};return e=u({},i,e),n&&p.isPC&&(e.ePos=this._getEventPosition(n)),this.send("openDatePicker",e,null,t)}},{key:"openRichEditor",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n={value:""};return e=u({},n,e),this.send("openRichEditor",e,null,t)}},{key:"openShare",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],i={title:"",content:"",image:"",via:"",url:"",type:""};return e=u({},i,e),n&&p.isPC&&(e.ePos=this._getEventPosition(n)),this.send("openShare",e,null,t)}},{key:"openAttachment",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];arguments[2];return p.isPC?window.open(e.link.source):(t.file_info=e,void this.push("openAttachment",t))}},{key:"genQRCode",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t=u({},b,t,{text:e}),this.send("genQRCode",t)}},{key:"showQRCode",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2];t=u({},b,t,{text:e}),n&&p.isPC&&(t.ePos=this._getEventPosition(n)),this.push("showQRCode",t)}},{key:"scanQRCode",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return"boolean"!=typeof e.needResult&&(e.needResult=!0),this.send("scanQRCode",e)}},{key:"getLocation",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1],n=arguments[2],i={enableHighAccuracy:!0,timeout:5e3,maximumAge:1e4,convert:!0,title:"选择地址",placement:"left-bottom"};return e=u({},i,e),n&&p.isPC&&(e.ePos=this._getEventPosition(n)),this.send("getLocation",e,null,t)}},{key:"setPageConfig",value:function(e){this.push("setPageConfig",{config:e})}},{key:"installApplication",value:function(e){this.push("installApplication",{application_id:e})}},{key:"installPackage",value:function(e){this.push("installPackage",{package_id:e})}},{key:"_init",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.send("init",u({application_id:e},n)).then(function(n){t._ticket=n.ticket,t._user=n.user,t._table=n.table||n.app;var i=t._table.table_id||t._table.app_id;return t._table.app_id=t._table.table_id=i,t._version=n.version,t.applicationId=e,u({},n,{app:t._table,table:t._table})})}},{key:"_getEventPosition",value:function(e){var t=e.currentTarget||e.target,n=t.getBoundingClientRect(),i=n.top,r=n.bottom,o=n.left,s=n.right,a=n.width,u=n.height,c=e.clientX,l=e.clientY,f=e.offsetX,h=e.offsetY;return{target:{top:i,bottom:r,left:o,right:s,width:a,height:u,offsetWidth:e.target.offsetWidth,offsetHeight:e.target.offsetHeight},clientX:c,clientY:l,offsetX:f,offsetY:h}}},{key:"_checkUp2V2",value:function(){var e=void 0;return e=p.isClientAndroid?(0,f["default"])(this._version,"2.4.0")>=0:p.isClientIOS?(0,f["default"])(this._version,"140")>=0:(0,f["default"])(this._version,"4.1")>=0}}]),t}(_["default"]);t["default"]=g,e.exports=t["default"]},function(e,t){e.exports=function(e,t){for(var n=e.split("."),i=t.split("."),r=0;r<3;r++){var o=Number(n[r]),s=Number(i[r]);if(o>s)return 1;if(s>o)return-1;if(!isNaN(o)&&isNaN(s))return 1;if(isNaN(o)&&!isNaN(s))return-1}return 0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(12),u=i(a),c=n(7),l=i(c),f=n(1),h=function(){function e(t){r(this,e),this.connect=(0,l["default"])(),this.promises={},this.handlers={},t&&this.on(t)}return s(e,[{key:"ready",value:function(e){return this.connect.promise.then(e),this}},{key:"on",value:function(e,t,n){var i=this,r=void 0;return t||"object"!=("undefined"==typeof e?"undefined":o(e))?r=[this._on(e,t,n)]:(r=[],Object.keys(e).forEach(function(t){r.push(i._on(t,e[t],n))})),{on:this.on.bind(this),revoke:r[0],revokes:r}}},{key:"_on",value:function(e,t,n){var i=this,r=function(){};return e&&t&&(!n&&this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t),r=function(){i.off(e,t)}),r}},{key:"off",value:function(e,t){if(e&&this.handlers[e])if(t){var n=this.handlers[e].indexOf(t);n>=0&&this.handlers[e].splice(n,1)}else this.handlers[e]=[];else"!"==e&&(this.handlers={});return this}},{key:"emit",value:function(e,t,n){var i=[],r=!1,o=!1;if(e&&this.handlers[e]){var s=this.handlers[e];i=s.map(function(e){var i=void 0;return r||(i=e(t,n),!1===i&&(r=!0),o=!0),i})}return"*"!=e&&this.handlers["*"]&&(i=i.concat(this.handlers["*"].map(function(i){return i(e,t,o?null:n)}))),i}},{key:"push",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this.ready(function(){t._send(e,n)})}},{key:"send",value:function(e,t,n,i){var r=this,o=n||this._unique_id();if(this.ready(function(){r._send(e,t,o)}),i&&"function"==typeof i)return this.promises[o]=i,o;var s=(0,l["default"])();return this.promises[o]=s,s.promise}},{key:"handleMessage",value:function(e){var t=this;if(!1!==this._processMessage(e)){var n=void 0,i=void 0,r=void 0,o=void 0;try{if(n=e.data,"string"==typeof n&&((f.isIPhone||f.isIPad)&&(n=n.replace(/[\r\n\t]+/g,"")),n=JSON.parse(n)),!n.action&&!n.id&&!n.callback)throw new Error}catch(s){throw this.emit("error",{type:"json",source:n,err:s}),this.emit("error.json",{source:n,err:s}),alert("HB_APP_SDK: JSON解析失败, 请将当前界面截图反馈, 谢谢!\n"+JSON.stringify(s)+"\n"+n),new Error("HB_APP_SDK: malformed message")}if(i=n.id||n.callback,r=n.action,o=n.params||n.data,i){if(i in this.promises){var a=this.promises[i];a.resolve?(n.error?a.reject(n.error):n.result?a.resolve(n.result):a.reject({cancelled:!0}),this.promises[i]=null,delete this.promises[i]):n.result||n.error?this.promises[i](n.result,n.error):this.promises[i](null,{cancelled:!0})}else if(r&&this.handlers[r]){var u=function(e){t.send(r,e,i)};this.emit(r,o,u)}}else r?(this.emit(r,o),o&&o.action&&this.emit(r+"."+o.action,o.data)):this.emit("*",o)}}},{key:"destroy",value:function(){this.off("!"),this.connect=(0,l["default"])()}},{key:"_send",value:function(){}},{key:"_processMessage",value:function(e){return e}},{key:"_unique_id",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"cb_":arguments[0],t=arguments.length<=1||void 0===arguments[1]?10:arguments[1],n=arguments.length<=2||void 0===arguments[2]?16:arguments[2],i="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";return u["default"].generateUUID(e+i.substr(0,t),n)()}}]),e}();t["default"]=h,e.exports=t["default"]},function(e,t){function n(e,t){function n(){var t=(new Date).getTime(),n=i.length;return e.replace(/[xy]/g,function(e){var r=(t+Math.random()*n)%n|0;return t=Math.floor(t/n),i["x"===e?r:3&r|8]})}e="string"==typeof e?e:r,t="number"==typeof t?t:s;var i=o.slice(0,t);return n}var i,r="xxxxyxxxxyxxxxyxxxxy",o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s=16;i=n(),i.generateUUID=n,e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function h(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:h(r,t,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},c=n(9),l=i(c),f=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"init",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.connect.resolve(),window.HB=window.HB||{},window.HB.bridgeCallback=this.handleBridgeInvoke.bind(this,"callback"),window.HB.bridgeCancel=this.handleBridgeInvoke.bind(this,"cancel"),window.HB.bridgeEmit=this.handleBridgeInvoke.bind(this,"emit"),this._init(e,t)}},{key:"_send",value:function(e,t,n){var i=["huoban://hybrid?action="+encodeURIComponent(e)];n&&i.push("callback="+encodeURIComponent(n)),t&&i.push("params="+encodeURIComponent(JSON.stringify(t)));var r=i.join("&");this._invokeNative(r)}},{key:"_invokeNative",value:function(e){var t=document.createElement("iframe");t.style.width=0,t.style.height=0,t.style.display="none",t.src=e,document.body.appendChild(t),setTimeout(function(){t.parentNode.removeChild(t)},100)}},{key:"handleBridgeInvoke",value:function(e,t){return this.handleMessage({data:t})}},{key:"destroy",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),delete window.HB.bridgeCallback,delete window.HB.bridgeCancel,delete window.HB.bridgeEmit}}]),t}(l["default"]);t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(13),c=i(u),l=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"_invokeNative",value:function(e){window.prompt(e,"")}}]),t}(c["default"]);t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function y(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:y(r,t,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},l=n(7),f=i(l),h=n(1),d=n(11),p=i(d),v=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),u(t,[{key:"init",value:function(){var e=this;this.heartbeatFrequency=5,this.connections={},this.handleHandshake=this._handleHandshake.bind(this),window.addEventListener("message",this.handleHandshake,!1),this.ready(function(){e.runHeartbeatDetection()})}},{key:"runHeartbeatDetection",value:function(){var e=this;this.getPorts().forEach(function(t){var n=t.client,i=(t.port,t.lastPing);i&&e.now()-i>2*e.heartbeatFrequency*1e3?(console.log("close",n,(e.now()-i)/1e3),e._close(n)):e.push(n,h.MSG_TYPES.PING)}),setTimeout(function(){e.runHeartbeatDetection()},1e3*this.heartbeatFrequency)}},{key:"destroy",value:function(e){var n=this;c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.getPorts().forEach(function(e){var t=e.client;n._close(t)}),this.connections={},e&&window.removeEventListener("message",this.handleHandshake)}},{key:"_close",value:function(e){this.connections[e]&&(this.connections[e].port.close(),this.connections[e].port.onmessage=null,delete this.connections[e])}},{key:"now",value:function(){return Date.now()}},{key:"report",value:function(){var e=0,t=this.getPorts().reduce(function(t,n){
return e++,t[n.application_id]||(t[n.application_id]=0),t[n.application_id]++,t},{}),n=Object.keys(t);console.log("当前已连接应用数：",n.length,", 已连接页面总数：",e,", 应用计数统计：",t)}},{key:"getPorts",value:function(e){var t=this;return Object.keys(this.connections).reduce(function(n,i){return e&&t.connections[i].application_id!=e||n.push(t.connections[i]),n},[])}},{key:"_handleHandshake",value:function(e){var t=this,n=e.data&&e.data.split?e.data.split(":"):[];if(3==n.length&&n[0]==h.MSG_TYPES.CONNECT&&e.ports.length){var i=function(){var i=n[1],r=n[2];if(!i||t.getPorts(i).length>=10)return e.ports[0].postMessage({action:h.MSG_TYPES.CONNECT,data:{error:{message:"Too many connections"}}}),{v:void 0};t.connections[r]={client:r,application_id:i,port:e.ports[0]};var o=function(e,n){n?(t.connections[r]&&t._send(r,h.MSG_TYPES.CONNECT,{error:{message:n}}),delete t.connections[r]):(t.connections[r].port.onmessage=t.handlePortMessage.bind(t,r),t.connect.resolve(r),t.push(r,h.MSG_TYPES.CONNECT,{result:{message:e}}))};t.emit("connect",{application_id:i,origin:e.origin,client:r},o)}();if("object"===("undefined"==typeof i?"undefined":a(i)))return i.v}}},{key:"send",value:function(e,t,n,i){var r=this,o=i||this._unique_id("h_");this.ready(function(){r._send(e,t,n,o)});var s=(0,f["default"])();return this.promises[o]=s,s.promise}},{key:"push",value:function(e,t){var n=this,i=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.ready(function(){n._send(e,t,i)})}},{key:"_send",value:function(e,t,n,i){if(this.connections[e]){var r={action:t};n&&(r.data=n),i&&(r.id=i),this.connections[e].port.postMessage(r)}else this.emit("error",{type:"send",data:{message:"连接不存在"}})}},{key:"handlePortMessage",value:function(e,t){var n=this;if(!1!==this._processMessage(t,e)){if(!this.connections[e])throw new Error("message client error: "+e);var i=void 0,r=void 0,o=void 0;try{if(i=t.data,"string"==typeof i&&(i=JSON.parse(i)),!i.action&&!i.id&&i.callback)throw new Error}catch(s){throw new Error("HB_APP_SDK: malformed message")}r=i.id||i.callback,o=i.action;var a=void 0;r&&(a=function(t,i){i?n.connections[e].port.postMessage({id:r,error:i}):n.connections[e].port.postMessage({id:r,result:t})}),this.emit(o,{application_id:parseInt(this.connections[e].application_id,10),params:i.data},a)}}},{key:"_processMessage",value:function(e,t){switch(e.data.action){case h.MSG_TYPES.DISCONNECT:return this._close(t),!1;case h.MSG_TYPES.BROADCAST:return this._broadcast(this.connections[t].application_id,e.data.data,[t]),!1;case h.MSG_TYPES.PING:return this.connections[t].lastPing=this.now(),!1}}},{key:"broadcast",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this._broadcast(n,t?{action:e,data:t}:{action:e})}},{key:"_broadcast",value:function(e,t){var n=this,i=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];this.getPorts(e).forEach(function(e){var r=e.client;e.port;i.indexOf(r)===-1&&n.push(r,h.MSG_TYPES.BROADCAST,t)})}}]),t}(p["default"]);t["default"]=v,e.exports=t["default"]}])});